<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ArtemisOps - Mission Control</title>
  <!-- Leaflet CSS for ISS Tracker -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Courier New', monospace;
      background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #0d1128 100%);
      color: #e0e6ed;
      overflow: hidden;
      height: 100vh;
      width: 100vw;
    }

    /* ===== DESKTOP TABBED LAYOUT ===== */
    .app-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      width: 100vw;
      overflow: hidden;
    }

    .app-header {
      flex-shrink: 0;
      border-bottom: 2px solid #4a9eff;
      background: rgba(10, 20, 40, 0.9);
      padding: 12px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 0 30px rgba(74, 158, 255, 0.3);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .header-center {
      display: flex;
      align-items: center;
      gap: 20px;
      flex: 1;
      justify-content: center;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .header-logo {
      height: 50px;
      width: 50px;
      object-fit: contain;
    }

    .header-title {
      font-size: 1.8em;
      letter-spacing: 6px;
      color: #4a9eff;
      text-transform: uppercase;
      text-shadow: 0 0 15px rgba(74, 158, 255, 0.8);
    }

    .header-subtitle {
      font-size: 0.75em;
      color: #8ab4f8;
      letter-spacing: 2px;
      max-width: 300px;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
    }

    /* Tab Navigation */
    .tab-nav {
      flex-shrink: 0;
      display: flex;
      background: rgba(10, 20, 40, 0.8);
      border-bottom: 2px solid rgba(74, 158, 255, 0.3);
      padding: 0 20px;
    }

    .tab-btn {
      background: none;
      border: none;
      color: #6a7f99;
      padding: 15px 30px;
      font-family: 'Courier New', monospace;
      font-size: 1em;
      letter-spacing: 3px;
      text-transform: uppercase;
      cursor: pointer;
      position: relative;
      transition: all 0.3s ease;
    }

    .tab-btn:hover {
      color: #8ab4f8;
    }

    .tab-btn.active {
      color: #4a9eff;
      text-shadow: 0 0 10px rgba(74, 158, 255, 0.5);
    }

    .tab-btn.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 3px;
      background: #4a9eff;
      box-shadow: 0 0 10px rgba(74, 158, 255, 0.8);
    }

    .tab-btn .tab-icon {
      margin-right: 8px;
    }

    /* Tab Content Area */
    .tab-content {
      flex: 1;
      overflow: hidden;
      position: relative;
    }

    .tab-panel {
      display: none;
      height: 100%;
      padding: 20px;
      overflow: hidden;
    }

    .tab-panel.active {
      display: flex;
      flex-direction: column;
    }

    /* ===== MISSION TAB LAYOUT ===== */
    .mission-tab {
      display: grid;
      grid-template-rows: auto 1fr auto;
      gap: 15px;
      height: 100%;
    }

    .countdown-section {
      background: rgba(15, 25, 45, 0.9);
      border: 2px solid #4a9eff;
      padding: 25px;
      text-align: center;
      box-shadow: 0 0 30px rgba(74, 158, 255, 0.3);
    }

    .countdown-section .countdown-mode-indicator {
      font-size: 1.1em;
      margin-bottom: 10px;
    }

    .countdown-section .countdown-timer {
      display: flex;
      justify-content: center;
      gap: 20px;
    }

    .countdown-section .time-value {
      font-size: 2.8em;
      min-width: 90px;
      padding: 12px;
    }

    .countdown-section .time-label {
      font-size: 0.8em;
      margin-top: 5px;
    }

    .countdown-section .launch-info {
      margin-top: 10px;
      font-size: 0.95em;
    }

    .middle-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      min-height: 0;
    }

    .weather-panel, .status-panel-desktop {
      background: rgba(15, 25, 45, 0.9);
      border: 2px solid #4a9eff;
      padding: 20px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .weather-panel {
      border-color: #ffa500;
    }

    .panel-title {
      font-size: 1em;
      color: #4a9eff;
      letter-spacing: 2px;
      text-transform: uppercase;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(74, 158, 255, 0.3);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .weather-panel .panel-title {
      color: #ffa500;
      border-bottom-color: rgba(255, 165, 0, 0.3);
    }

    .panel-content {
      flex: 1;
      overflow: auto;
    }

    .timeline-section-desktop {
      background: rgba(15, 25, 45, 0.9);
      border: 2px solid #4a9eff;
      padding: 15px 20px;
      overflow: hidden;
    }

    .timeline-section-desktop .panel-title {
      margin-bottom: 10px;
    }

    .timeline-compact {
      overflow-x: auto;
      padding: 10px 0;
    }

    /* ===== CREW TAB LAYOUT ===== */
    .crew-tab {
      height: 100%;
      overflow: hidden;
    }

    .crew-grid-desktop {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      height: 100%;
      padding: 10px;
    }

    .crew-card-desktop {
      background: rgba(15, 25, 45, 0.9);
      border: 2px solid #4a9eff;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      overflow: hidden;
    }

    .crew-card-desktop .crew-photo {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #4a9eff;
      margin-bottom: 15px;
    }

    .crew-card-desktop .crew-name {
      font-size: 1.2em;
      font-weight: bold;
      color: #e0e6ed;
      margin-bottom: 5px;
    }

    .crew-card-desktop .crew-role {
      font-size: 0.9em;
      color: #4a9eff;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 8px;
    }

    .crew-card-desktop .crew-agency {
      font-size: 0.75em;
      color: #8ab4f8;
      background: rgba(74, 158, 255, 0.15);
      padding: 3px 12px;
      border-radius: 12px;
      margin-bottom: 12px;
    }

    .crew-card-desktop .crew-bio {
      font-size: 0.8em;
      color: #8ab4f8;
      line-height: 1.5;
      flex: 1;
      overflow: auto;
    }

    .crew-card-desktop .crew-link {
      margin-top: 10px;
      font-size: 0.8em;
      color: #4a9eff;
      text-decoration: none;
    }

    .crew-card-desktop .crew-link:hover {
      text-decoration: underline;
    }

    /* ===== INFO TAB LAYOUT ===== */
    .info-tab {
      display: grid;
      grid-template-rows: 1fr auto;
      gap: 15px;
      height: 100%;
    }

    .info-top-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      min-height: 0;
    }

    .info-panel {
      background: rgba(15, 25, 45, 0.9);
      border: 2px solid #4a9eff;
      padding: 20px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .mission-details-grid {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 10px 15px;
      font-size: 0.9em;
    }

    .detail-label {
      color: #6a7f99;
      text-transform: uppercase;
      font-size: 0.8em;
      letter-spacing: 1px;
    }

    .detail-value {
      color: #e0e6ed;
    }

    .news-list {
      list-style: none;
    }

    .news-item {
      padding: 12px 0;
      border-bottom: 1px solid rgba(74, 158, 255, 0.2);
    }

    .news-item:last-child {
      border-bottom: none;
    }

    .news-link {
      color: #4a9eff;
      text-decoration: none;
      font-size: 0.9em;
      display: block;
      margin-bottom: 5px;
    }

    .news-link:hover {
      text-decoration: underline;
    }

    .news-date {
      color: #6a7f99;
      font-size: 0.75em;
    }

    .events-panel {
      background: rgba(15, 25, 45, 0.9);
      border: 2px solid #ffa500;
      padding: 15px 20px;
    }

    .events-panel .panel-title {
      color: #ffa500;
      border-bottom-color: rgba(255, 165, 0, 0.3);
      margin-bottom: 10px;
    }

    .events-list {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }

    .event-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 10px 15px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 4px;
    }

    .event-icon {
      font-size: 1.5em;
    }

    .event-info {
      flex: 1;
    }

    .event-title {
      color: #e0e6ed;
      font-size: 0.9em;
    }

    .event-date {
      color: #6a7f99;
      font-size: 0.8em;
    }

    .event-link {
      color: #ffa500;
      text-decoration: none;
      font-size: 0.85em;
    }

    .event-link:hover {
      text-decoration: underline;
    }

    /* ===== MOBILE ICON BAR LAYOUT ===== */
    @media (max-width: 768px) {
      .app-container {
        padding-bottom: 70px; /* Space for icon bar */
      }

      .app-header {
        padding: 8px 15px;
      }

      .header-logo {
        height: 35px;
        width: 35px;
      }

      .header-title {
        font-size: 1.2em;
        letter-spacing: 3px;
      }

      .header-subtitle {
        display: none;
      }

      /* Hide desktop tab nav on mobile */
      .tab-nav {
        display: none;
      }

      /* Show icon bar on mobile */
      .icon-bar {
        display: flex !important;
      }

      .tab-content {
        padding-bottom: 70px;
      }

      .tab-panel {
        padding: 10px;
      }

      /* Mobile Mission Panel */
      .mission-tab {
        grid-template-rows: auto auto auto auto;
        gap: 10px;
      }

      .countdown-section {
        padding: 15px;
      }

      .countdown-section .time-value {
        font-size: 1.8em;
        min-width: 60px;
        padding: 8px;
      }

      .countdown-section .countdown-timer {
        gap: 8px;
      }

      .countdown-section .countdown-mode-indicator {
        font-size: 0.85em;
        padding: 6px 12px;
        letter-spacing: 2px;
      }

      .countdown-section .launch-info {
        font-size: 0.8em;
      }

      .middle-row {
        grid-template-columns: 1fr;
        gap: 10px;
      }

      .weather-panel, .status-panel-desktop {
        padding: 12px;
      }

      .panel-title {
        font-size: 0.85em;
        margin-bottom: 10px;
        padding-bottom: 8px;
      }

      .timeline-section-desktop {
        padding: 10px 12px;
      }

      /* Mobile Crew Panel */
      .crew-grid-desktop {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        padding: 5px;
      }

      .crew-card-desktop {
        padding: 12px;
      }

      .crew-card-desktop .crew-photo {
        width: 70px;
        height: 70px;
      }

      .crew-card-desktop .crew-name {
        font-size: 0.95em;
      }

      .crew-card-desktop .crew-role {
        font-size: 0.75em;
      }

      .crew-card-desktop .crew-bio {
        font-size: 0.7em;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      /* Mobile Info Panel */
      .info-tab {
        grid-template-rows: auto auto auto;
      }

      .info-top-row {
        grid-template-columns: 1fr;
        gap: 10px;
      }

      .info-panel {
        padding: 12px;
      }

      .events-panel {
        padding: 10px 12px;
      }

      .events-list {
        flex-direction: column;
        gap: 10px;
      }
    }

    /* Icon Bar - Hidden on desktop, shown on mobile */
    .icon-bar {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 70px;
      background: rgba(10, 20, 40, 0.98);
      border-top: 2px solid #4a9eff;
      z-index: 1001;
      justify-content: space-around;
      align-items: center;
      padding: 5px 0;
      box-shadow: 0 -5px 30px rgba(74, 158, 255, 0.3);
    }

    .icon-bar-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: none;
      border: none;
      color: #6a7f99;
      padding: 8px 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      border-radius: 8px;
    }

    .icon-bar-btn:hover {
      color: #8ab4f8;
    }

    .icon-bar-btn.active {
      color: #4a9eff;
      background: rgba(74, 158, 255, 0.15);
    }

    .icon-bar-btn .icon {
      font-size: 1.5em;
      margin-bottom: 4px;
    }

    .icon-bar-btn .label {
      font-size: 0.65em;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-family: 'Courier New', monospace;
    }
    /* ===== END MOBILE ICON BAR LAYOUT ===== */

    /* ===== TRACKING TAB STYLES ===== */
    .tracking-tab {
      padding: 0 !important;
    }
    
    .tracking-container {
      display: flex;
      flex-direction: column;
      height: 100%;
      background: #0a1628;
    }
    
    .tracking-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 16px;
      background: rgba(10, 20, 40, 0.9);
      border-bottom: 1px solid #1a3a5c;
    }
    
    .tracking-mode-selector {
      display: flex;
      gap: 8px;
    }
    
    .tracking-mode-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(0, 188, 212, 0.1);
      border: 1px solid #1a3a5c;
      color: #8b949e;
      padding: 8px 16px;
      font-family: 'Courier New', monospace;
      font-size: 0.8em;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s;
    }
    
    .tracking-mode-btn:hover {
      border-color: #00bcd4;
      color: #00bcd4;
    }
    
    .tracking-mode-btn.active {
      background: rgba(0, 188, 212, 0.2);
      border-color: #00bcd4;
      color: #00bcd4;
    }
    
    .tracking-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.85em;
      color: #8b949e;
    }
    
    .tracking-map-container {
      flex: 1;
      display: flex;
      min-height: 0;
    }
    
    .map-wrapper {
      flex: 1;
      position: relative;
      background: #0a1628;
    }
    
    #iss-map {
      background: #0a1628 !important;
    }
    
    .iss-data-overlay {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(10, 22, 40, 0.95);
      border: 1px solid #1a3a5c;
      border-radius: 4px;
      padding: 12px;
      z-index: 1000;
      min-width: 180px;
    }
    
    .iss-data-overlay .data-row {
      display: flex;
      gap: 16px;
      margin-bottom: 8px;
    }
    
    .iss-data-overlay .data-row:last-child {
      margin-bottom: 0;
    }
    
    .iss-data-overlay .data-item label {
      font-size: 0.55rem;
      color: #8b949e;
      letter-spacing: 1px;
      display: block;
      margin-bottom: 2px;
    }
    
    .iss-data-overlay .data-item span {
      font-family: 'Courier New', monospace;
      font-size: 0.95rem;
      color: #fff;
    }
    
    .map-controls {
      position: absolute;
      top: 12px;
      right: 12px;
      display: flex;
      gap: 6px;
      z-index: 1000;
    }
    
    .map-ctrl-btn {
      background: rgba(10, 22, 40, 0.9);
      border: 1px solid #1a3a5c;
      color: #8b949e;
      padding: 6px 12px;
      font-family: 'Courier New', monospace;
      font-size: 0.7em;
      cursor: pointer;
      border-radius: 3px;
      transition: all 0.2s;
    }
    
    .map-ctrl-btn:hover {
      border-color: #00bcd4;
      color: #00bcd4;
    }
    
    .map-ctrl-btn.active {
      background: rgba(0, 188, 212, 0.2);
      border-color: #00bcd4;
      color: #00bcd4;
    }
    
    .iss-side-panel {
      width: 280px;
      background: #0d1a2d;
      border-left: 1px solid #1a3a5c;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }
    
    .iss-side-panel .panel-section {
      border-bottom: 1px solid #1a3a5c;
    }
    
    .iss-side-panel .section-header {
      padding: 10px 14px;
      background: rgba(0, 188, 212, 0.1);
    }
    
    .iss-side-panel .section-title {
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 1px;
      color: #00bcd4;
      text-transform: uppercase;
    }
    
    .iss-side-panel .section-content {
      padding: 12px 14px;
    }
    
    .telemetry-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    
    .telemetry-item {
      background: rgba(0, 0, 0, 0.3);
      padding: 10px;
      border-radius: 4px;
      text-align: center;
    }
    
    .telemetry-value {
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      font-weight: 700;
      color: #fff;
    }
    
    .telemetry-label {
      font-size: 0.55rem;
      color: #8b949e;
      letter-spacing: 1px;
      margin-top: 4px;
      text-transform: uppercase;
    }
    
    .crew-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
      max-height: 140px;
      overflow-y: auto;
    }
    
    .crew-member {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(126, 211, 33, 0.1);
      border: 1px solid #7ed321;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 0.7rem;
    }
    
    .crew-dot {
      width: 6px;
      height: 6px;
      background: #7ed321;
      border-radius: 50%;
    }
    
    .crew-agency {
      margin-left: auto;
      color: #8b949e;
      font-size: 0.6rem;
    }
    
    .position-display {
      text-align: center;
    }
    
    .position-label {
      font-size: 0.6rem;
      color: #8b949e;
      letter-spacing: 1px;
      text-transform: uppercase;
      margin-bottom: 4px;
    }
    
    .position-location {
      font-family: 'Courier New', monospace;
      font-size: 1.1rem;
      color: #00bcd4;
      margin-bottom: 2px;
    }
    
    .position-country {
      font-size: 0.75rem;
      color: #8b949e;
    }
    
    .artemis-container {
      background: #0a1628;
    }
    
    /* Leaflet customizations for ISS tracker */
    .leaflet-container {
      background: #0a1628 !important;
    }
    
    .leaflet-control-attribution {
      background: rgba(13, 26, 45, 0.8) !important;
      color: #8b949e !important;
      font-size: 10px !important;
    }
    
    .leaflet-control-attribution a {
      color: #00bcd4 !important;
    }
    
    .leaflet-control-zoom a {
      background: #0d1a2d !important;
      color: #00bcd4 !important;
      border-color: #1a3a5c !important;
    }
    
    .leaflet-control-zoom a:hover {
      background: #1a3a5c !important;
    }
    
    .iss-marker {
      background: transparent !important;
      border: none !important;
    }
    
    .iss-icon {
      filter: drop-shadow(0 0 10px #00bcd4);
      animation: iss-pulse 2s ease-in-out infinite;
    }
    
    @keyframes iss-pulse {
      0%, 100% { filter: drop-shadow(0 0 10px #00bcd4); }
      50% { filter: drop-shadow(0 0 20px #ffd60a); }
    }
    
    .leaflet-popup-content-wrapper {
      background: #0d1a2d !important;
      border: 1px solid #00bcd4 !important;
      border-radius: 4px !important;
      color: #fff !important;
    }
    
    .leaflet-popup-tip {
      background: #0d1a2d !important;
    }
    
    .leaflet-popup-content {
      font-family: 'Courier New', monospace;
      font-size: 11px;
      margin: 10px;
    }
    
    /* Mobile tracking adjustments */
    @media (max-width: 768px) {
      .tracking-header {
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
      }
      
      .tracking-mode-selector {
        flex-wrap: wrap;
      }
      
      .tracking-mode-btn {
        padding: 6px 10px;
        font-size: 0.7em;
      }
      
      .tracking-map-container {
        flex-direction: column;
      }
      
      .iss-side-panel {
        width: 100%;
        max-height: 200px;
        border-left: none;
        border-top: 1px solid #1a3a5c;
      }
      
      .iss-data-overlay {
        bottom: 10px;
        left: 10px;
        padding: 8px;
        min-width: 150px;
      }
      
      .iss-data-overlay .data-item span {
        font-size: 0.85rem;
      }
      
      .map-controls {
        top: 8px;
        right: 8px;
      }
      
      .map-ctrl-btn {
        padding: 4px 8px;
        font-size: 0.65em;
      }
    }
    /* ===== END TRACKING TAB STYLES ===== */

    /* ===== END DESKTOP TABBED LAYOUT ===== */

    .scanlines {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: repeating-linear-gradient(
        0deg,
        rgba(0, 0, 0, 0.15),
        rgba(0, 0, 0, 0.15) 1px,
        transparent 1px,
        transparent 2px
      );
      pointer-events: none;
      z-index: 1000;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 40px 20px;
      position: relative;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
      border: 2px solid #4a9eff;
      background: rgba(10, 20, 40, 0.7);
      padding: 20px;
      box-shadow: 0 0 30px rgba(74, 158, 255, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 30px;
    }

    .logo-container {
      display: flex;
      gap: 20px;
      align-items: center;
      min-width: 100px;
    }

    .logo {
      height: 80px;
      width: 80px;
      object-fit: contain;
      display: block;
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .logo:hover {
      transform: scale(1.05);
    }
    
    @media (max-width: 768px) {
      .logo {
        height: 60px;
        width: 60px;
      }
    }

    .header-text {
      flex: 1;
      max-width: 600px;
    }

    .mission-title {
      font-size: 2.5em;
      letter-spacing: 8px;
      color: #4a9eff;
      text-transform: uppercase;
      margin-bottom: 10px;
      text-shadow: 0 0 20px rgba(74, 158, 255, 0.8);
    }

    .mission-subtitle {
      font-size: 1em;
      color: #8ab4f8;
      letter-spacing: 3px;
    }

    /* ===== MISSION SELECTOR STYLES ===== */
    .mission-selector-container {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1001;
    }

    .mission-selector {
      background: rgba(15, 25, 45, 0.95);
      border: 2px solid #4a9eff;
      color: #e0e6ed;
      padding: 10px 35px 10px 15px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      cursor: pointer;
      appearance: none;
      -webkit-appearance: none;
      border-radius: 4px;
      min-width: 200px;
      box-shadow: 0 0 20px rgba(74, 158, 255, 0.3);
      transition: all 0.3s ease;
    }

    .mission-selector:hover {
      box-shadow: 0 0 30px rgba(74, 158, 255, 0.5);
    }

    .mission-selector:focus {
      outline: none;
      border-color: #8ab4f8;
    }

    .mission-selector-container::after {
      content: '▼';
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #4a9eff;
      pointer-events: none;
      font-size: 0.7em;
    }

    .mission-selector option {
      background: #0a0e27;
      color: #e0e6ed;
      padding: 10px;
    }

    .mission-loading {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(10, 14, 39, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
    }

    .mission-loading.active {
      opacity: 1;
      visibility: visible;
    }

    .mission-loading-content {
      text-align: center;
    }

    .mission-loading-spinner {
      width: 50px;
      height: 50px;
      border: 3px solid rgba(74, 158, 255, 0.3);
      border-top-color: #4a9eff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .mission-loading-text {
      color: #4a9eff;
      font-size: 1.2em;
      letter-spacing: 2px;
    }
    /* ===== END MISSION SELECTOR STYLES ===== */

    .countdown-display {
      background: rgba(15, 25, 45, 0.9);
      border: 3px solid #4a9eff;
      padding: 50px;
      margin-bottom: 40px;
      text-align: center;
      box-shadow: 0 0 40px rgba(74, 158, 255, 0.4), inset 0 0 30px rgba(0, 0, 0, 0.5);
      position: relative;
    }

    .countdown-display::before {
      content: '';
      position: absolute;
      top: 10px;
      left: 10px;
      right: 10px;
      bottom: 10px;
      border: 1px solid rgba(74, 158, 255, 0.3);
      pointer-events: none;
    }

    .countdown-timer {
      display: flex;
      justify-content: center;
      gap: 30px;
      flex-wrap: wrap;
    }

    .time-unit {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .time-value {
      font-size: 4em;
      font-weight: bold;
      color: #4a9eff;
      text-shadow: 0 0 20px rgba(74, 158, 255, 0.8);
      font-family: 'Courier New', monospace;
      min-width: 120px;
      background: rgba(0, 0, 0, 0.4);
      padding: 20px;
      border: 2px solid rgba(74, 158, 255, 0.5);
      transition: all 0.5s ease;
    }

    .time-label {
      font-size: 0.9em;
      color: #8ab4f8;
      margin-top: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      transition: all 0.5s ease;
    }

    /* ===== ELAPSED TIME MODE (Post-Launch) ===== */
    .countdown-display.elapsed-mode {
      border-color: #4aff9e;
      box-shadow: 0 0 40px rgba(74, 255, 158, 0.4), inset 0 0 30px rgba(0, 0, 0, 0.5);
    }

    .countdown-display.elapsed-mode::before {
      border-color: rgba(74, 255, 158, 0.3);
    }

    .countdown-display.elapsed-mode .time-value {
      color: #4aff9e;
      text-shadow: 0 0 20px rgba(74, 255, 158, 0.8);
      border-color: rgba(74, 255, 158, 0.5);
    }

    .countdown-display.elapsed-mode .time-label {
      color: #8af8b4;
    }

    .countdown-mode-indicator {
      font-size: 1.4em;
      font-weight: bold;
      letter-spacing: 4px;
      margin-bottom: 20px;
      padding: 10px 20px;
      display: inline-block;
      border-radius: 4px;
      transition: all 0.5s ease;
    }

    .countdown-mode-indicator.countdown {
      color: #4a9eff;
      background: rgba(74, 158, 255, 0.15);
      border: 1px solid rgba(74, 158, 255, 0.3);
    }

    .countdown-mode-indicator.elapsed {
      color: #4aff9e;
      background: rgba(74, 255, 158, 0.15);
      border: 1px solid rgba(74, 255, 158, 0.3);
      animation: pulse-green 2s infinite;
    }

    @keyframes pulse-green {
      0%, 100% { 
        box-shadow: 0 0 10px rgba(74, 255, 158, 0.5);
      }
      50% { 
        box-shadow: 0 0 25px rgba(74, 255, 158, 0.8);
      }
    }
    /* ===== END ELAPSED TIME MODE ===== */

    .launch-info {
      text-align: center;
      margin-top: 20px;
      font-size: 1.1em;
      color: #b8c5d6;
    }

    /* ===== NOTIFICATION SYSTEM STYLES ===== */
    .notification-bell {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1001;
      background: rgba(15, 25, 45, 0.95);
      border: 2px solid #4a9eff;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 20px rgba(74, 158, 255, 0.3);
    }

    .notification-bell:hover {
      transform: scale(1.1);
      box-shadow: 0 0 30px rgba(74, 158, 255, 0.5);
    }

    .notification-bell svg {
      width: 24px;
      height: 24px;
      fill: #4a9eff;
    }

    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ff4444;
      color: white;
      font-size: 12px;
      font-weight: bold;
      min-width: 20px;
      height: 20px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 5px;
      box-shadow: 0 0 10px rgba(255, 68, 68, 0.8);
    }

    .notification-badge.hidden {
      display: none;
    }

    .notification-panel {
      position: fixed;
      top: 80px;
      right: 20px;
      width: 380px;
      max-height: 500px;
      background: rgba(15, 25, 45, 0.98);
      border: 2px solid #4a9eff;
      border-radius: 8px;
      z-index: 1001;
      overflow: hidden;
      transform: translateX(120%);
      transition: transform 0.3s ease;
      box-shadow: 0 0 40px rgba(74, 158, 255, 0.4);
    }

    .notification-panel.open {
      transform: translateX(0);
    }

    .notification-header {
      background: rgba(74, 158, 255, 0.2);
      padding: 15px 20px;
      border-bottom: 1px solid #4a9eff;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .notification-header h3 {
      color: #4a9eff;
      font-size: 1em;
      letter-spacing: 2px;
      text-transform: uppercase;
    }

    .notification-settings-btn {
      background: none;
      border: 1px solid #4a9eff;
      color: #4a9eff;
      padding: 5px 10px;
      font-size: 0.75em;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .notification-settings-btn:hover {
      background: rgba(74, 158, 255, 0.2);
    }

    .notification-list {
      max-height: 400px;
      overflow-y: auto;
    }

    .notification-item {
      padding: 15px 20px;
      border-bottom: 1px solid rgba(74, 158, 255, 0.2);
      cursor: pointer;
      transition: background 0.2s;
    }

    .notification-item:hover {
      background: rgba(74, 158, 255, 0.1);
    }

    .notification-item.unread {
      border-left: 3px solid #ffa500;
      background: rgba(255, 165, 0, 0.05);
    }

    .notification-item.milestone {
      border-left-color: #4a9eff;
    }

    .notification-item.alert {
      border-left-color: #ff4444;
    }

    .notification-item.success {
      border-left-color: #44ff44;
    }

    .notification-time {
      font-size: 0.7em;
      color: #6a7f99;
      margin-bottom: 5px;
    }

    .notification-title {
      font-size: 0.9em;
      color: #e0e6ed;
      margin-bottom: 5px;
      font-weight: bold;
    }

    .notification-body {
      font-size: 0.8em;
      color: #8ab4f8;
      line-height: 1.4;
    }

    .notification-empty {
      padding: 40px 20px;
      text-align: center;
      color: #6a7f99;
    }

    /* Notification Settings Modal */
    .notification-settings-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1002;
      display: none;
      align-items: center;
      justify-content: center;
    }

    .notification-settings-modal.open {
      display: flex;
    }

    .settings-content {
      background: rgba(15, 25, 45, 0.98);
      border: 2px solid #4a9eff;
      border-radius: 8px;
      padding: 30px;
      max-width: 400px;
      width: 90%;
    }

    .settings-content h3 {
      color: #4a9eff;
      margin-bottom: 20px;
      letter-spacing: 2px;
    }

    .setting-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
      border-bottom: 1px solid rgba(74, 158, 255, 0.2);
    }

    .setting-label {
      color: #e0e6ed;
      font-size: 0.9em;
    }

    .setting-description {
      color: #6a7f99;
      font-size: 0.75em;
      margin-top: 5px;
    }

    .toggle-switch {
      position: relative;
      width: 50px;
      height: 26px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: #333;
      border-radius: 26px;
      transition: 0.3s;
    }

    .toggle-slider::before {
      position: absolute;
      content: "";
      height: 20px;
      width: 20px;
      left: 3px;
      bottom: 3px;
      background: white;
      border-radius: 50%;
      transition: 0.3s;
    }

    .toggle-switch input:checked + .toggle-slider {
      background: #4a9eff;
    }

    .toggle-switch input:checked + .toggle-slider::before {
      transform: translateX(24px);
    }

    .settings-close-btn {
      width: 100%;
      margin-top: 20px;
      padding: 12px;
      background: #4a9eff;
      border: none;
      color: white;
      font-family: inherit;
      font-size: 1em;
      cursor: pointer;
      border-radius: 4px;
      letter-spacing: 2px;
    }

    .settings-close-btn:hover {
      background: #3a8eef;
    }

    /* Sound selector styles */
    .sound-selector {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .sound-selector select {
      background: rgba(15, 25, 45, 0.9);
      border: 1px solid #4a9eff;
      color: #e0e6ed;
      padding: 8px 12px;
      font-family: 'Courier New', monospace;
      font-size: 0.85em;
      border-radius: 4px;
      cursor: pointer;
      min-width: 140px;
    }

    .sound-selector select:focus {
      outline: none;
      border-color: #8ab4f8;
    }

    .sound-selector select option {
      background: #0a0e27;
      color: #e0e6ed;
    }

    .sound-preview-btn {
      background: rgba(74, 158, 255, 0.2);
      border: 1px solid #4a9eff;
      color: #4a9eff;
      width: 36px;
      height: 36px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1em;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .sound-preview-btn:hover {
      background: rgba(74, 158, 255, 0.3);
      box-shadow: 0 0 10px rgba(74, 158, 255, 0.3);
    }

    .sound-style-setting {
      flex-direction: column;
      align-items: flex-start !important;
      gap: 10px;
    }

    .sound-style-setting > div:first-child {
      width: 100%;
    }

    /* Toast Notifications */
    .toast-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1003;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .toast {
      background: rgba(15, 25, 45, 0.98);
      border: 2px solid #4a9eff;
      border-radius: 8px;
      padding: 15px 20px;
      min-width: 300px;
      max-width: 400px;
      box-shadow: 0 0 30px rgba(74, 158, 255, 0.4);
      animation: slideIn 0.3s ease, fadeOut 0.3s ease 4.7s forwards;
      display: flex;
      align-items: flex-start;
      gap: 15px;
    }

    .toast.milestone {
      border-color: #4a9eff;
    }

    .toast.alert {
      border-color: #ff4444;
    }

    .toast.success {
      border-color: #44ff44;
    }

    .toast.countdown {
      border-color: #ffa500;
    }

    .toast-icon {
      font-size: 1.5em;
      line-height: 1;
    }

    .toast-content {
      flex: 1;
    }

    .toast-title {
      font-size: 0.9em;
      font-weight: bold;
      color: #e0e6ed;
      margin-bottom: 5px;
    }

    .toast-body {
      font-size: 0.8em;
      color: #8ab4f8;
    }

    .toast-close {
      background: none;
      border: none;
      color: #6a7f99;
      cursor: pointer;
      font-size: 1.2em;
      padding: 0;
      line-height: 1;
    }

    .toast-close:hover {
      color: #e0e6ed;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes fadeOut {
      from {
        opacity: 1;
      }
      to {
        opacity: 0;
      }
    }

    /* ===== END NOTIFICATION STYLES ===== */

    .timeline-section {
      background: rgba(15, 25, 45, 0.8);
      border: 2px solid #4a9eff;
      padding: 30px;
      margin-bottom: 40px;
      box-shadow: 0 0 30px rgba(74, 158, 255, 0.2);
    }

    .section-title {
      font-size: 1.5em;
      color: #4a9eff;
      margin-bottom: 25px;
      letter-spacing: 3px;
      text-transform: uppercase;
      border-bottom: 2px solid #4a9eff;
      padding-bottom: 10px;
    }

    .timeline-container {
      position: relative;
      overflow-x: auto;
      padding: 40px 20px 60px;
      margin-top: 20px;
    }

    .timeline-track {
      position: relative;
      height: 4px;
      background: linear-gradient(to right, 
        #4a9eff 0%, 
        #4a9eff var(--progress, 30%), 
        #555 var(--progress, 30%), 
        #555 100%
      );
      margin: 60px 0;
      box-shadow: 0 0 10px rgba(74, 158, 255, 0.5);
    }

    .timeline-milestones {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      position: relative;
      min-width: 100%;
    }

    .milestone {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      flex: 1;
      min-width: 120px;
      transition: all 0.3s ease;
    }

    .milestone-marker {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #555;
      border: 3px solid #555;
      position: relative;
      z-index: 2;
      transition: all 0.3s ease;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    }

    .milestone.completed .milestone-marker {
      background: #4a9eff;
      border-color: #4a9eff;
      box-shadow: 0 0 20px rgba(74, 158, 255, 0.8);
    }

    .milestone.active .milestone-marker {
      background: #ffa500;
      border-color: #ffa500;
      box-shadow: 0 0 30px rgba(255, 165, 0, 1);
      animation: pulse-marker 2s infinite;
    }

    @keyframes pulse-marker {
      0%, 100% { 
        transform: scale(1);
        box-shadow: 0 0 30px rgba(255, 165, 0, 1);
      }
      50% { 
        transform: scale(1.3);
        box-shadow: 0 0 40px rgba(255, 165, 0, 1);
      }
    }

    .milestone-status {
      position: absolute;
      top: -40px;
      font-size: 1.8em;
      text-shadow: 0 0 10px rgba(74, 158, 255, 0.8);
    }

    .milestone.completed .milestone-status {
      color: #4a9eff;
    }

    .milestone.active .milestone-status {
      color: #ffa500;
    }

    .milestone.pending .milestone-status {
      color: #666;
    }

    .milestone-content {
      margin-top: 30px;
      text-align: center;
      max-width: 180px;
    }

    .milestone-date {
      color: #8ab4f8;
      font-size: 0.75em;
      margin-bottom: 8px;
      font-weight: bold;
      letter-spacing: 1px;
    }

    .milestone-title {
      color: #e0e6ed;
      font-size: 0.85em;
      font-weight: bold;
      margin-bottom: 6px;
      line-height: 1.3;
    }

    .milestone-description {
      color: #8ab4f8;
      font-size: 0.7em;
      line-height: 1.3;
      opacity: 0.8;
    }

    .milestone:hover .milestone-description {
      opacity: 1;
    }

    .milestone:hover .milestone-marker {
      transform: scale(1.3);
    }

    .status-panel {
      background: rgba(15, 25, 45, 0.8);
      border: 2px solid #4a9eff;
      padding: 30px;
      box-shadow: 0 0 30px rgba(74, 158, 255, 0.2);
    }

    /* ===== CREW PANEL STYLES ===== */
    .crew-section {
      background: rgba(15, 25, 45, 0.8);
      border: 2px solid #4a9eff;
      padding: 30px;
      margin-bottom: 40px;
      box-shadow: 0 0 30px rgba(74, 158, 255, 0.2);
    }

    .crew-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .crew-card {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(74, 158, 255, 0.3);
      padding: 20px;
      display: flex;
      gap: 15px;
      transition: all 0.3s ease;
    }

    .crew-card:hover {
      border-color: #4a9eff;
      box-shadow: 0 0 20px rgba(74, 158, 255, 0.3);
    }

    .crew-photo {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #4a9eff;
      flex-shrink: 0;
    }

    .crew-photo-placeholder {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: rgba(74, 158, 255, 0.2);
      border: 2px solid #4a9eff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2em;
      flex-shrink: 0;
    }

    .crew-info {
      flex: 1;
      min-width: 0;
    }

    .crew-name {
      font-size: 1.1em;
      font-weight: bold;
      color: #e0e6ed;
      margin-bottom: 4px;
    }

    .crew-role {
      font-size: 0.85em;
      color: #4a9eff;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .crew-agency {
      display: inline-block;
      font-size: 0.7em;
      color: #8ab4f8;
      background: rgba(74, 158, 255, 0.15);
      padding: 2px 8px;
      border-radius: 10px;
      margin-bottom: 8px;
    }

    .crew-bio {
      font-size: 0.8em;
      color: #8ab4f8;
      line-height: 1.4;
    }

    .crew-twitter {
      font-size: 0.75em;
      color: #4a9eff;
      margin-top: 8px;
      text-decoration: none;
    }

    .crew-twitter:hover {
      text-decoration: underline;
    }

    .crew-loading {
      text-align: center;
      padding: 40px;
      color: #8ab4f8;
    }

    @media (max-width: 600px) {
      .crew-card {
        flex-direction: column;
        align-items: center;
        text-align: center;
      }
    }
    /* ===== END CREW PANEL STYLES ===== */

    /* ===== WEATHER PANEL STYLES ===== */
    .weather-section {
      background: rgba(15, 25, 45, 0.9);
      border: 2px solid #ffa500;
      padding: 25px;
      margin-bottom: 40px;
      box-shadow: 0 0 30px rgba(255, 165, 0, 0.3);
      display: none;
    }

    .weather-section.visible {
      display: block;
      animation: weatherSlideIn 0.5s ease;
    }

    @keyframes weatherSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .weather-section .section-title {
      color: #ffa500;
      border-bottom-color: #ffa500;
    }

    .weather-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 20px;
    }

    .weather-event-type {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .weather-event-badge {
      background: rgba(255, 165, 0, 0.2);
      border: 1px solid #ffa500;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.85em;
      color: #ffa500;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .weather-site {
      color: #8ab4f8;
      font-size: 0.9em;
    }

    .weather-status-card {
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 20px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .weather-icon {
      font-size: 3.5em;
      line-height: 1;
    }

    .weather-main {
      flex: 1;
    }

    .weather-condition {
      font-size: 1.3em;
      color: #e0e6ed;
      margin-bottom: 5px;
    }

    .weather-temp {
      font-size: 1.1em;
      color: #8ab4f8;
    }

    .weather-viability {
      text-align: right;
    }

    .viability-badge {
      display: inline-block;
      padding: 8px 20px;
      border-radius: 4px;
      font-size: 1em;
      font-weight: bold;
      letter-spacing: 2px;
      text-transform: uppercase;
    }

    .viability-badge.go {
      background: rgba(74, 255, 158, 0.2);
      border: 2px solid #4aff9e;
      color: #4aff9e;
      box-shadow: 0 0 15px rgba(74, 255, 158, 0.4);
    }

    .viability-badge.marginal {
      background: rgba(255, 165, 0, 0.2);
      border: 2px solid #ffa500;
      color: #ffa500;
      box-shadow: 0 0 15px rgba(255, 165, 0, 0.4);
    }

    .viability-badge.no-go {
      background: rgba(255, 68, 68, 0.2);
      border: 2px solid #ff4444;
      color: #ff4444;
      box-shadow: 0 0 15px rgba(255, 68, 68, 0.4);
    }

    .weather-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .weather-detail-item {
      background: rgba(0, 0, 0, 0.2);
      padding: 15px;
      border-radius: 4px;
      text-align: center;
      border: 1px solid rgba(255, 165, 0, 0.2);
    }

    .weather-detail-value {
      font-size: 1.4em;
      color: #e0e6ed;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .weather-detail-label {
      font-size: 0.75em;
      color: #8ab4f8;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .weather-issues {
      margin-top: 15px;
      padding: 15px;
      background: rgba(255, 68, 68, 0.1);
      border: 1px solid rgba(255, 68, 68, 0.3);
      border-radius: 4px;
    }

    .weather-issues-title {
      color: #ff6666;
      font-size: 0.85em;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 10px;
    }

    .weather-issue {
      color: #ff9999;
      font-size: 0.9em;
      padding: 5px 0;
      padding-left: 15px;
      position: relative;
    }

    .weather-issue::before {
      content: '⚠';
      position: absolute;
      left: 0;
    }

    .weather-loading {
      text-align: center;
      padding: 30px;
      color: #8ab4f8;
    }

    .weather-toggle-btn {
      background: rgba(255, 165, 0, 0.2);
      border: 1px solid #ffa500;
      color: #ffa500;
      padding: 6px 12px;
      font-family: 'Courier New', monospace;
      font-size: 0.75em;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .weather-toggle-btn:hover {
      background: rgba(255, 165, 0, 0.3);
      box-shadow: 0 0 10px rgba(255, 165, 0, 0.3);
    }

    .weather-toggle-btn.on {
      background: rgba(74, 255, 158, 0.2);
      border-color: #4aff9e;
      color: #4aff9e;
    }

    .weather-toggle-btn.on:hover {
      background: rgba(74, 255, 158, 0.3);
      box-shadow: 0 0 10px rgba(74, 255, 158, 0.3);
    }

    .weather-toggle-btn.off {
      background: rgba(255, 68, 68, 0.2);
      border-color: #ff6666;
      color: #ff6666;
    }

    .weather-toggle-btn.off:hover {
      background: rgba(255, 68, 68, 0.3);
      box-shadow: 0 0 10px rgba(255, 68, 68, 0.3);
    }

    .weather-toggle-btn.auto {
      background: rgba(74, 158, 255, 0.2);
      border-color: #4a9eff;
      color: #4a9eff;
    }

    .weather-toggle-btn.auto:hover {
      background: rgba(74, 158, 255, 0.3);
      box-shadow: 0 0 10px rgba(74, 158, 255, 0.3);
    }

    /* Weather show button (when panel is hidden) */
    .weather-show-btn {
      position: fixed;
      bottom: 80px;
      left: 20px;
      background: rgba(15, 25, 45, 0.95);
      border: 2px solid #ffa500;
      color: #ffa500;
      padding: 10px 15px;
      font-family: 'Courier New', monospace;
      font-size: 0.85em;
      cursor: pointer;
      border-radius: 4px;
      z-index: 1001;
      transition: all 0.3s;
      box-shadow: 0 0 20px rgba(255, 165, 0, 0.3);
      display: none;
    }

    .weather-show-btn:hover {
      background: rgba(255, 165, 0, 0.2);
      box-shadow: 0 0 30px rgba(255, 165, 0, 0.5);
    }

    .weather-show-btn.visible {
      display: block;
    }

    @media (max-width: 600px) {
      .weather-status-card {
        flex-direction: column;
        text-align: center;
      }
      
      .weather-viability {
        text-align: center;
      }
    }
    /* ===== END WEATHER PANEL STYLES ===== */

    .status-text {
      color: #e0e6ed;
      line-height: 1.8;
      margin-bottom: 20px;
      padding: 20px;
      background: rgba(0, 0, 0, 0.3);
      border-left: 4px solid #4a9eff;
    }

    .next-milestone {
      padding: 20px;
      background: rgba(255, 165, 0, 0.1);
      border: 2px solid #ffa500;
      margin-top: 20px;
    }

    .next-milestone-title {
      color: #ffa500;
      font-size: 1.2em;
      margin-bottom: 10px;
      letter-spacing: 2px;
    }

    .next-milestone-text {
      color: #e0e6ed;
      line-height: 1.6;
    }

    .last-update {
      text-align: center;
      color: #8ab4f8;
      font-size: 0.8em;
      margin-top: 30px;
      opacity: 0.7;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    .live-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      background: #4a9eff;
      border-radius: 50%;
      margin-right: 8px;
      animation: pulse 2s infinite;
      box-shadow: 0 0 10px rgba(74, 158, 255, 0.8);
    }

    .live-indicator.error {
      background: #ff4444;
      box-shadow: 0 0 10px rgba(255, 68, 68, 0.8);
    }

    .live-indicator.warning {
      background: #ffa500;
      box-shadow: 0 0 10px rgba(255, 165, 0, 0.8);
    }

    .error-banner {
      background: rgba(255, 68, 68, 0.2);
      border: 2px solid #ff4444;
      padding: 15px;
      margin-bottom: 20px;
      text-align: center;
      color: #ff9999;
      border-radius: 4px;
    }

    .warning-banner {
      background: rgba(255, 165, 0, 0.2);
      border: 2px solid #ffa500;
      padding: 15px;
      margin-bottom: 20px;
      text-align: center;
      color: #ffcc99;
      border-radius: 4px;
    }

    .loading {
      opacity: 0.5;
      pointer-events: none;
    }

    .data-source {
      font-size: 0.8em;
      color: #6a7f99;
      font-style: italic;
      margin-top: 5px;
    }

    @media (max-width: 768px) {
      .header {
        flex-direction: column;
      }
      
      .time-value {
        font-size: 2.5em;
        min-width: 80px;
        padding: 15px;
      }

      .notification-panel {
        width: calc(100% - 40px);
        right: 20px;
        left: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="scanlines"></div>
  
  <!-- Mission Loading Overlay -->
  <div class="mission-loading" id="missionLoading">
    <div class="mission-loading-content">
      <div class="mission-loading-spinner"></div>
      <div class="mission-loading-text">LOADING MISSION DATA...</div>
    </div>
  </div>

  <!-- ===== NEW TABBED/PANEL LAYOUT ===== -->
  <div class="app-container">
    
    <!-- App Header -->
    <header class="app-header">
      <div class="header-left">
        <img id="agencyLogo" src="https://www.nasa.gov/wp-content/uploads/2023/04/nasa-logo-web-rgb.png" alt="Agency Logo" class="header-logo" onerror="this.style.display='none'">
        <div>
          <div class="header-title" id="missionTitle">ARTEMIS II</div>
          <div class="header-subtitle" id="missionSubtitle">First Crewed Lunar Flyby Since Apollo 17</div>
        </div>
      </div>
      <div class="header-center">
        <select class="mission-selector" id="missionSelector" onchange="MissionManager.switchMission(this.value)">
          <option value="">Loading missions...</option>
        </select>
      </div>
      <div class="header-right">
        <img id="missionPatch" src="https://www.nasa.gov/wp-content/uploads/2025/04/jsc2025e034746orig.jpg" alt="Mission Patch" class="header-logo" onerror="this.style.display='none'">
        <div class="notification-bell" id="notificationBell" onclick="toggleNotificationPanel()">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"/>
          </svg>
          <span class="notification-badge hidden" id="notificationBadge">0</span>
        </div>
      </div>
    </header>
    
    <!-- Tab Navigation (Desktop) -->
    <nav class="tab-nav">
      <button class="tab-btn active" data-panel="mission" onclick="ViewManager.switchPanel('mission')">
        <span class="tab-icon">🚀</span> Mission
      </button>
      <button class="tab-btn" data-panel="tracking" onclick="ViewManager.switchPanel('tracking')">
        <span class="tab-icon">🛰️</span> Tracking
      </button>
      <button class="tab-btn" data-panel="crew" onclick="ViewManager.switchPanel('crew')">
        <span class="tab-icon">👨‍🚀</span> Crew
      </button>
      <button class="tab-btn" data-panel="info" onclick="ViewManager.switchPanel('info')">
        <span class="tab-icon">ℹ️</span> Info
      </button>
    </nav>
    
    <!-- Tab Content -->
    <main class="tab-content">
      
      <!-- MISSION PANEL -->
      <div class="tab-panel mission-tab active" id="panel-mission">
        
        <!-- Countdown Section -->
        <section class="countdown-section" id="countdownDisplay">
          <div class="countdown-mode-indicator countdown" id="countdownModeIndicator">T-MINUS · COUNTDOWN TO LAUNCH</div>
          <div class="countdown-timer">
            <div class="time-unit">
              <div class="time-value" id="days">---</div>
              <div class="time-label">Days</div>
            </div>
            <div class="time-unit">
              <div class="time-value" id="hours">--</div>
              <div class="time-label">Hours</div>
            </div>
            <div class="time-unit">
              <div class="time-value" id="minutes">--</div>
              <div class="time-label">Minutes</div>
            </div>
            <div class="time-unit">
              <div class="time-value" id="seconds">--</div>
              <div class="time-label">Seconds</div>
            </div>
          </div>
          <div class="launch-info" id="launchInfo">Loading launch data...</div>
        </section>
        
        <!-- Middle Row: Weather + Status -->
        <div class="middle-row">
          
          <!-- Weather Panel -->
          <div class="weather-panel" id="weatherPanelDesktop">
            <div class="panel-title">
              <span class="live-indicator" id="weatherIndicator"></span>
              <span id="weatherTitle">🌤️ Launch Weather</span>
              <button class="weather-toggle-btn auto" id="weatherToggleBtn" onclick="WeatherManager.toggle()" style="margin-left: auto;">☁️ AUTO</button>
            </div>
            <div class="panel-content" id="weatherContent">
              <div class="weather-loading">Checking weather...</div>
            </div>
          </div>
          
          <!-- Status Panel -->
          <div class="status-panel-desktop">
            <div class="panel-title">
              <span class="live-indicator" id="statusIndicator"></span>
              Mission Status
            </div>
            <div class="panel-content">
              <div class="status-text" id="statusText">Loading mission status...</div>
              <div class="next-milestone">
                <div class="next-milestone-title">NEXT MILESTONE</div>
                <div class="next-milestone-text" id="nextMilestone">Loading...</div>
              </div>
            </div>
          </div>
          
        </div>
        
        <!-- Timeline Section -->
        <section class="timeline-section-desktop">
          <div class="panel-title">
            <span class="live-indicator" id="timelineIndicator"></span>
            Pre-Launch Timeline
          </div>
          <div class="timeline-compact" id="timeline">
            <div style="text-align: center; padding: 20px; color: #8ab4f8;">Loading timeline...</div>
          </div>
        </section>
        
      </div>
      
      <!-- TRACKING PANEL -->
      <div class="tab-panel tracking-tab" id="panel-tracking">
        <div class="tracking-container">
          <!-- Tracking Mode Selector -->
          <div class="tracking-header">
            <div class="tracking-mode-selector">
              <button class="tracking-mode-btn active" data-mode="iss" onclick="TrackingManager.switchMode('iss')">
                <span class="mode-icon"></span>
                <span class="mode-label">ISS Live</span>
              </button>
              <button class="tracking-mode-btn" data-mode="artemis-ii" onclick="TrackingManager.switchMode('artemis-ii')">
                <span class="mode-icon"></span>
                <span class="mode-label">Artemis II</span>
              </button>
              <button class="tracking-mode-btn" data-mode="artemis-iii" onclick="TrackingManager.switchMode('artemis-iii')">
                <span class="mode-icon"></span>
                <span class="mode-label">Artemis III</span>
              </button>
            </div>
            <div class="tracking-status">
              <span class="live-indicator" id="trackingIndicator"></span>
              <span id="trackingStatusText">ISS Live Tracking</span>
            </div>
          </div>
          
          <!-- ISS Tracker Container -->
          <div class="tracking-map-container" id="issTrackerContainer">
            <div class="map-wrapper">
              <div id="iss-map" style="width: 100%; height: 100%;"></div>
              <!-- ISS Data Overlay -->
              <div class="iss-data-overlay" id="issDataOverlay">
                <div class="data-row">
                  <div class="data-item">
                    <label>LATITUDE</label>
                    <span id="issLat">--°</span>
                  </div>
                  <div class="data-item">
                    <label>LONGITUDE</label>
                    <span id="issLng">--°</span>
                  </div>
                </div>
                <div class="data-row">
                  <div class="data-item">
                    <label>ALTITUDE</label>
                    <span id="issAlt">-- km</span>
                  </div>
                  <div class="data-item">
                    <label>VELOCITY</label>
                    <span id="issVel">-- km/h</span>
                  </div>
                </div>
              </div>
              <!-- Map Controls -->
              <div class="map-controls">
                <button class="map-ctrl-btn active" id="btnFootprint" onclick="TrackingManager.toggleFootprint()" title="Toggle visibility footprint">Footprint</button>
                <button class="map-ctrl-btn active" id="btnTrack" onclick="TrackingManager.toggleTrack()" title="Toggle ground track">Track</button>
                <button class="map-ctrl-btn" id="btnCenter" onclick="TrackingManager.centerOnISS()" title="Center map on ISS">Center</button>
              </div>
            </div>
            <!-- ISS Side Panel -->
            <div class="iss-side-panel">
              <div class="panel-section">
                <div class="section-header">
                  <span class="section-title">Station Status</span>
                </div>
                <div class="section-content">
                  <div class="telemetry-grid">
                    <div class="telemetry-item">
                      <div class="telemetry-value" style="color:#7ed321" id="issStatus">NOMINAL</div>
                      <div class="telemetry-label">Systems</div>
                    </div>
                    <div class="telemetry-item">
                      <div class="telemetry-value" id="issAltTel">-- km</div>
                      <div class="telemetry-label">Altitude</div>
                    </div>
                    <div class="telemetry-item">
                      <div class="telemetry-value" id="issVisTel">--</div>
                      <div class="telemetry-label">Visibility</div>
                    </div>
                    <div class="telemetry-item">
                      <div class="telemetry-value">92 min</div>
                      <div class="telemetry-label">Orbit Period</div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="panel-section">
                <div class="section-header">
                  <span class="section-title">Crew (<span id="issCrewCount">-</span>)</span>
                </div>
                <div class="section-content">
                  <div class="crew-list" id="issCrewList">
                    <div style="color: var(--text-secondary); font-size: 0.7rem;">Loading crew...</div>
                  </div>
                </div>
              </div>
              <div class="panel-section">
                <div class="section-header">
                  <span class="section-title">Position</span>
                </div>
                <div class="section-content">
                  <div class="position-display">
                    <div class="position-label">Currently over</div>
                    <div class="position-location" id="issLocation">--</div>
                    <div class="position-country" id="issCountry">Calculating...</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Artemis II Container (hidden by default) -->
          <div class="tracking-map-container artemis-container" id="artemisIIContainer" style="display: none;">
            <iframe src="mockups/mode3-artemis2-nasa-style.html" style="width: 100%; height: 100%; border: none;"></iframe>
          </div>
          
          <!-- Artemis III Container (hidden by default) -->
          <div class="tracking-map-container artemis-container" id="artemisIIIContainer" style="display: none;">
            <iframe src="mockups/mode3-artemis3-nrho.html" style="width: 100%; height: 100%; border: none;"></iframe>
          </div>
          
        </div>
      </div>
      
      <!-- CREW PANEL -->
      <div class="tab-panel crew-tab" id="panel-crew">
        <div class="crew-grid-desktop" id="crewGrid">
          <div class="crew-loading">Loading crew information...</div>
        </div>
      </div>
      
      <!-- INFO PANEL -->
      <div class="tab-panel info-tab" id="panel-info">
        
        <!-- Info Top Row -->
        <div class="info-top-row">
          
          <!-- Mission Details -->
          <div class="info-panel">
            <div class="panel-title">Mission Details</div>
            <div class="panel-content">
              <div class="mission-details-grid" id="missionDetails">
                <span class="detail-label">Vehicle</span>
                <span class="detail-value" id="detailVehicle">SLS Block 1</span>
                <span class="detail-label">Spacecraft</span>
                <span class="detail-value" id="detailSpacecraft">Orion</span>
                <span class="detail-label">Duration</span>
                <span class="detail-value" id="detailDuration">~10 days</span>
                <span class="detail-label">Destination</span>
                <span class="detail-value" id="detailDestination">Lunar Free Return</span>
                <span class="detail-label">Agencies</span>
                <span class="detail-value" id="detailAgencies">NASA, CSA</span>
                <span class="detail-label">Launch Site</span>
                <span class="detail-value" id="detailLaunchSite">KSC Pad 39B</span>
              </div>
            </div>
          </div>
          
          <!-- News Panel -->
          <div class="info-panel">
            <div class="panel-title">Latest News</div>
            <div class="panel-content">
              <ul class="news-list" id="newsList">
                <li class="news-item">
                  <a href="#" class="news-link">Loading news...</a>
                </li>
              </ul>
            </div>
          </div>
          
        </div>
        
        <!-- Events Panel -->
        <div class="events-panel">
          <div class="panel-title">📺 Upcoming Live Events</div>
          <div class="events-list" id="eventsList">
            <div class="event-item">
              <span class="event-icon">📺</span>
              <div class="event-info">
                <div class="event-title">Launch Coverage</div>
                <div class="event-date">April 1, 2026</div>
              </div>
              <a href="https://www.youtube.com/nasa" target="_blank" class="event-link">Watch →</a>
            </div>
          </div>
        </div>
        
      </div>
      
    </main>
    
    <!-- Bottom Navigation (Mobile) -->
    <nav class="icon-bar">
      <button class="icon-bar-btn active" data-panel="mission" onclick="ViewManager.switchPanel('mission')">
        <span class="icon">🚀</span>
        <span class="label">Mission</span>
      </button>
      <button class="icon-bar-btn" data-panel="tracking" onclick="ViewManager.switchPanel('tracking')">
        <span class="icon">🛰️</span>
        <span class="label">Tracking</span>
      </button>
      <button class="icon-bar-btn" data-panel="crew" onclick="ViewManager.switchPanel('crew')">
        <span class="icon">👨‍🚀</span>
        <span class="label">Crew</span>
      </button>
      <button class="icon-bar-btn" data-panel="info" onclick="ViewManager.switchPanel('info')">
        <span class="icon">ℹ️</span>
        <span class="label">Info</span>
      </button>
    </nav>
    
  </div>
  <!-- ===== END TABBED/PANEL LAYOUT ===== -->

  <!-- Notification Panel -->
  <div class="notification-panel" id="notificationPanel">
    <div class="notification-header">
      <h3>Notifications</h3>
      <button class="notification-settings-btn" onclick="openNotificationSettings()">⚙ Settings</button>
    </div>
    <div class="notification-list" id="notificationList">
      <div class="notification-empty">No notifications yet</div>
    </div>
  </div>

  <!-- Notification Settings Modal -->
  <div class="notification-settings-modal" id="notificationSettingsModal">
    <div class="settings-content">
      <h3>NOTIFICATION SETTINGS</h3>
      
      <div class="setting-item">
        <div>
          <div class="setting-label">Milestone Alerts</div>
          <div class="setting-description">Notify when milestones are completed</div>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" id="settingMilestones" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>

      <div class="setting-item">
        <div>
          <div class="setting-label">Countdown Alerts</div>
          <div class="setting-description">T-24h, T-1h, T-10min warnings</div>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" id="settingCountdown" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>

      <div class="setting-item">
        <div>
          <div class="setting-label">Status Changes</div>
          <div class="setting-description">Mission status updates and holds</div>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" id="settingStatus" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>

      <div class="setting-item">
        <div>
          <div class="setting-label">Sound Effects</div>
          <div class="setting-description">Play audio for notifications</div>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" id="settingSound">
          <span class="toggle-slider"></span>
        </label>
      </div>

      <div class="setting-item sound-style-setting" id="soundStyleSetting">
        <div>
          <div class="setting-label">Alert Sound</div>
          <div class="setting-description">Choose notification sound style</div>
        </div>
        <div class="sound-selector">
          <select id="settingSoundStyle" onchange="NotificationSystem.previewSound()">
            <option value="mission-control">Mission Control</option>
            <option value="spacecraft">Spacecraft</option>
            <option value="digital">Digital</option>
            <option value="classic">Classic Bell</option>
            <option value="subtle">Subtle</option>
          </select>
          <button class="sound-preview-btn" onclick="NotificationSystem.previewSound()" title="Preview sound">
            🔊
          </button>
        </div>
      </div>

      <div class="setting-item">
        <div>
          <div class="setting-label">Browser Notifications</div>
          <div class="setting-description">Show system notifications</div>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" id="settingBrowser">
          <span class="toggle-slider"></span>
        </label>
      </div>

      <button class="settings-close-btn" onclick="closeNotificationSettings()">SAVE & CLOSE</button>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Weather Show Button (appears when panel is hidden) -->
  <button class="weather-show-btn" id="weatherShowBtn" onclick="WeatherManager.toggle()">
    ☁️ Show Weather
  </button>

  <div class="container">
    <div id="errorContainer"></div>

    <div class="header">
      <div class="logo-container" id="agencyLogoContainer">
        <img 
          id="agencyLogo"
          src="https://www.nasa.gov/wp-content/uploads/2023/04/nasa-logo-web-rgb.png" 
          alt="Agency Logo" 
          class="logo"
          onerror="this.style.display='none';">
      </div>
      <div class="header-text">
        <div class="mission-title" id="missionTitle">ARTEMIS II</div>
        <div class="mission-subtitle" id="missionSubtitle">First Crewed Lunar Flyby Since Apollo 17</div>
      </div>
      <div class="logo-container" id="missionPatchContainer">
        <img 
          id="missionPatch"
          src="https://www.nasa.gov/wp-content/uploads/2025/04/jsc2025e034746orig.jpg" 
          alt="Mission Patch" 
          class="logo"
          onerror="this.style.display='none';">
      </div>
    </div>

    <div class="countdown-display" id="countdownDisplay">
      <div class="countdown-mode-indicator countdown" id="countdownModeIndicator">T-MINUS</div>
      <div class="countdown-timer" id="countdown">
        <div class="time-unit">
          <div class="time-value" id="days">---</div>
          <div class="time-label">Days</div>
        </div>
        <div class="time-unit">
          <div class="time-value" id="hours">--</div>
          <div class="time-label">Hours</div>
        </div>
        <div class="time-unit">
          <div class="time-value" id="minutes">--</div>
          <div class="time-label">Minutes</div>
        </div>
        <div class="time-unit">
          <div class="time-value" id="seconds">--</div>
          <div class="time-label">Seconds</div>
        </div>
      </div>
      <div class="launch-info" id="launchInfo">
        Loading launch data...
      </div>
      <div class="data-source" id="launchDataSource"></div>
    </div>

    <!-- Weather Panel (only visible on launch/recovery day) -->
    <div class="weather-section" id="weatherSection">
      <div class="section-title" style="display: flex; justify-content: space-between; align-items: center;">
        <span>
          <span class="live-indicator" id="weatherIndicator"></span>
          <span id="weatherTitle">Launch Site Weather</span>
        </span>
        <button class="weather-toggle-btn" id="weatherToggleBtn" onclick="WeatherManager.toggle()">
          Hide Weather
        </button>
      </div>
      <div id="weatherContent">
        <div class="weather-loading">Checking weather conditions...</div>
      </div>
    </div>

    <!-- Crew Section -->
    <div class="crew-section">
      <div class="section-title">Flight Crew</div>
      <div class="crew-grid" id="crewGrid">
        <div class="crew-loading">Loading crew information...</div>
      </div>
    </div>

    <div class="timeline-section">
      <div class="section-title">
        <span class="live-indicator" id="timelineIndicator"></span>Pre-Launch & Launch Sequence
      </div>
      <div id="timeline">
        <div style="text-align: center; padding: 40px; color: #8ab4f8;">
          Loading timeline data...
        </div>
      </div>
      <div class="data-source" id="timelineDataSource"></div>
    </div>

    <div class="status-panel">
      <div class="section-title">
        <span class="live-indicator" id="statusIndicator"></span>Mission Status
      </div>
      <div class="status-text" id="statusText">
        Loading mission status...
      </div>
      <div class="data-source" id="statusDataSource"></div>

      <div class="next-milestone">
        <div class="next-milestone-title">NEXT MILESTONE</div>
        <div class="next-milestone-text" id="nextMilestone">
          Loading upcoming milestone information...
        </div>
      </div>
    </div>

    <div class="last-update">
      Last Updated: <span id="lastUpdate">Never</span>
    </div>
  </div>

  <script>
    // ===== VIEW MANAGER (Tab Navigation) =====
    const ViewManager = {
      currentPanel: 'mission',
      
      switchPanel(panelId) {
        this.currentPanel = panelId;
        
        // Update tab buttons
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.classList.toggle('active', btn.dataset.panel === panelId);
        });
        
        // Update icon bar buttons
        document.querySelectorAll('.icon-bar-btn').forEach(btn => {
          btn.classList.toggle('active', btn.dataset.panel === panelId);
        });
        
        // Update panels
        document.querySelectorAll('.tab-panel').forEach(panel => {
          panel.classList.toggle('active', panel.id === `panel-${panelId}`);
        });
      }
    };

    // ===== NOTIFICATION SYSTEM =====
    const NotificationSystem = {
      notifications: [],
      settings: {
        milestones: true,
        countdown: true,
        status: true,
        sound: false,
        soundStyle: 'mission-control',
        browser: false
      },
      audioContext: null,
      countdownAlerts: {
        '86400': { fired: false, label: '24 hours' },
        '3600': { fired: false, label: '1 hour' },
        '600': { fired: false, label: '10 minutes' },
        '60': { fired: false, label: '1 minute' },
        '10': { fired: false, label: '10 seconds' }
      },

      // Sound definitions for each style
      soundProfiles: {
        'mission-control': {
          // NASA-style mission control beeps
          milestone: { notes: [[880, 0.15], [1100, 0.15], [880, 0.2]], type: 'sine' },
          countdown: { notes: [[660, 0.1], [880, 0.1], [1100, 0.15]], type: 'sine' },
          status: { notes: [[440, 0.2], [550, 0.2]], type: 'sine' },
          alert: { notes: [[440, 0.15], [440, 0.15], [550, 0.3]], type: 'square' }
        },
        'spacecraft': {
          // Futuristic spacecraft sounds
          milestone: { notes: [[200, 0.1], [400, 0.1], [800, 0.2], [1200, 0.15]], type: 'sine' },
          countdown: { notes: [[300, 0.08], [600, 0.08], [900, 0.12]], type: 'triangle' },
          status: { notes: [[150, 0.15], [300, 0.15], [450, 0.2]], type: 'sine' },
          alert: { notes: [[500, 0.1], [400, 0.1], [500, 0.1], [400, 0.2]], type: 'sawtooth' }
        },
        'digital': {
          // Clean digital tones
          milestone: { notes: [[1000, 0.08], [1200, 0.08], [1400, 0.12]], type: 'square' },
          countdown: { notes: [[800, 0.06], [1000, 0.06], [1200, 0.1]], type: 'square' },
          status: { notes: [[600, 0.1], [800, 0.15]], type: 'square' },
          alert: { notes: [[500, 0.08], [500, 0.08], [700, 0.15]], type: 'square' }
        },
        'classic': {
          // Classic bell-like tones
          milestone: { notes: [[523, 0.3], [659, 0.3], [784, 0.4]], type: 'sine' },
          countdown: { notes: [[440, 0.2], [554, 0.2], [659, 0.3]], type: 'sine' },
          status: { notes: [[392, 0.25], [494, 0.35]], type: 'sine' },
          alert: { notes: [[349, 0.2], [440, 0.2], [523, 0.3]], type: 'sine' }
        },
        'subtle': {
          // Soft, minimal sounds
          milestone: { notes: [[600, 0.15], [700, 0.2]], type: 'sine', gain: 0.06 },
          countdown: { notes: [[500, 0.12], [600, 0.15]], type: 'sine', gain: 0.06 },
          status: { notes: [[400, 0.15]], type: 'sine', gain: 0.05 },
          alert: { notes: [[450, 0.1], [550, 0.15]], type: 'sine', gain: 0.06 }
        }
      },

      init() {
        const savedSettings = localStorage.getItem('artemisops_notification_settings');
        if (savedSettings) {
          this.settings = { ...this.settings, ...JSON.parse(savedSettings) };
          this.applySettingsToUI();
        }

        const savedNotifications = localStorage.getItem('artemisops_notifications');
        if (savedNotifications) {
          this.notifications = JSON.parse(savedNotifications);
          this.renderNotifications();
        }

        if (this.settings.browser && 'Notification' in window) {
          Notification.requestPermission();
        }

        if (!localStorage.getItem('artemisops_welcomed')) {
          this.add({
            type: 'milestone',
            title: 'Welcome to ArtemisOps',
            body: 'You\'ll receive notifications for mission milestones, countdown alerts, and status changes.',
            icon: '🚀'
          });
          localStorage.setItem('artemisops_welcomed', 'true');
        }
      },

      add(notification) {
        const newNotification = {
          id: Date.now(),
          timestamp: new Date().toISOString(),
          read: false,
          type: notification.type || 'info',
          title: notification.title,
          body: notification.body,
          icon: notification.icon || '📢'
        };

        this.notifications.unshift(newNotification);
        if (this.notifications.length > 50) {
          this.notifications = this.notifications.slice(0, 50);
        }

        this.save();
        this.renderNotifications();
        this.showToast(newNotification);

        if (this.settings.browser && 'Notification' in window && Notification.permission === 'granted') {
          new Notification(newNotification.title, {
            body: newNotification.body,
            icon: 'https://www.nasa.gov/wp-content/uploads/2023/04/nasa-logo-web-rgb.png'
          });
        }

        if (this.settings.sound) {
          this.playSound(notification.type);
        }
      },

      showToast(notification) {
        const container = document.getElementById('toastContainer');
        const toast = document.createElement('div');
        toast.className = `toast ${notification.type}`;
        toast.innerHTML = `
          <span class="toast-icon">${notification.icon}</span>
          <div class="toast-content">
            <div class="toast-title">${notification.title}</div>
            <div class="toast-body">${notification.body}</div>
          </div>
          <button class="toast-close" onclick="this.parentElement.remove()">×</button>
        `;
        container.appendChild(toast);
        setTimeout(() => { if (toast.parentElement) toast.remove(); }, 5000);
      },

      playSound(type) {
        try {
          // Get or create audio context
          if (!this.audioContext) {
            this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
          }
          
          // Resume context if suspended (browser autoplay policy)
          if (this.audioContext.state === 'suspended') {
            this.audioContext.resume();
          }
          
          const style = this.settings.soundStyle || 'mission-control';
          const profile = this.soundProfiles[style];
          if (!profile) return;
          
          // Map notification type to sound type
          const soundType = type === 'countdown' ? 'countdown' 
            : type === 'milestone' ? 'milestone'
            : type === 'status' ? 'status'
            : 'alert';
          
          const sound = profile[soundType] || profile.alert;
          if (!sound || !sound.notes) return;
          
          const baseGain = sound.gain || 0.1;
          let startTime = this.audioContext.currentTime;
          
          // Play each note in sequence
          sound.notes.forEach(([freq, duration]) => {
            const oscillator = this.audioContext.createOscillator();
            const gainNode = this.audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(this.audioContext.destination);
            
            oscillator.frequency.value = freq;
            oscillator.type = sound.type || 'sine';
            
            // Envelope for smoother sound
            gainNode.gain.setValueAtTime(0, startTime);
            gainNode.gain.linearRampToValueAtTime(baseGain, startTime + 0.01);
            gainNode.gain.linearRampToValueAtTime(baseGain * 0.7, startTime + duration * 0.7);
            gainNode.gain.linearRampToValueAtTime(0, startTime + duration);
            
            oscillator.start(startTime);
            oscillator.stop(startTime + duration + 0.05);
            
            startTime += duration;
          });
          
        } catch (e) { 
          console.log('Audio not supported:', e); 
        }
      },
      
      previewSound() {
        // Temporarily enable sound for preview
        const wasEnabled = this.settings.sound;
        this.settings.sound = true;
        this.settings.soundStyle = document.getElementById('settingSoundStyle').value;
        this.playSound('milestone');
        this.settings.sound = wasEnabled;
      },

      renderNotifications() {
        const list = document.getElementById('notificationList');
        const badge = document.getElementById('notificationBadge');
        const unreadCount = this.notifications.filter(n => !n.read).length;

        if (unreadCount > 0) {
          badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
          badge.classList.remove('hidden');
        } else {
          badge.classList.add('hidden');
        }

        if (this.notifications.length === 0) {
          list.innerHTML = '<div class="notification-empty">No notifications yet</div>';
          return;
        }

        list.innerHTML = this.notifications.map(n => `
          <div class="notification-item ${n.read ? '' : 'unread'} ${n.type}" 
               onclick="NotificationSystem.markAsRead(${n.id})">
            <div class="notification-time">${this.formatTime(n.timestamp)}</div>
            <div class="notification-title">${n.icon} ${n.title}</div>
            <div class="notification-body">${n.body}</div>
          </div>
        `).join('');
      },

      formatTime(timestamp) {
        const date = new Date(timestamp);
        const now = new Date();
        const diff = now - date;
        if (diff < 60000) return 'Just now';
        if (diff < 3600000) return `${Math.floor(diff / 60000)} min ago`;
        if (diff < 86400000) return `${Math.floor(diff / 3600000)} hours ago`;
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
      },

      markAsRead(id) {
        const notification = this.notifications.find(n => n.id === id);
        if (notification) {
          notification.read = true;
          this.save();
          this.renderNotifications();
        }
      },

      markAllAsRead() {
        this.notifications.forEach(n => n.read = true);
        this.save();
        this.renderNotifications();
      },

      save() {
        localStorage.setItem('artemisops_notifications', JSON.stringify(this.notifications));
      },

      saveSettings() {
        this.settings = {
          milestones: document.getElementById('settingMilestones').checked,
          countdown: document.getElementById('settingCountdown').checked,
          status: document.getElementById('settingStatus').checked,
          sound: document.getElementById('settingSound').checked,
          soundStyle: document.getElementById('settingSoundStyle').value,
          browser: document.getElementById('settingBrowser').checked
        };
        localStorage.setItem('artemisops_notification_settings', JSON.stringify(this.settings));
        if (this.settings.browser && 'Notification' in window) {
          Notification.requestPermission();
        }
      },

      applySettingsToUI() {
        document.getElementById('settingMilestones').checked = this.settings.milestones;
        document.getElementById('settingCountdown').checked = this.settings.countdown;
        document.getElementById('settingStatus').checked = this.settings.status;
        document.getElementById('settingSound').checked = this.settings.sound;
        document.getElementById('settingSoundStyle').value = this.settings.soundStyle || 'mission-control';
        document.getElementById('settingBrowser').checked = this.settings.browser;
      },

      checkCountdownAlerts(secondsRemaining) {
        if (!this.settings.countdown) return;
        for (const [seconds, alert] of Object.entries(this.countdownAlerts)) {
          if (!alert.fired && secondsRemaining <= parseInt(seconds) && secondsRemaining > 0) {
            alert.fired = true;
            this.add({
              type: 'countdown',
              title: `T-${alert.label}`,
              body: `Artemis II launch in ${alert.label}!`,
              icon: '⏱️'
            });
          }
        }
      },

      notifyMilestoneComplete(milestone) {
        if (!this.settings.milestones) return;
        this.add({
          type: 'milestone',
          title: 'Milestone Completed',
          body: `${milestone.title}: ${milestone.description}`,
          icon: '✅'
        });
      },

      notifyStatusChange(oldStatus, newStatus) {
        if (!this.settings.status) return;
        this.add({
          type: 'status',
          title: 'Mission Status Update',
          body: newStatus,
          icon: '📋'
        });
      },

      resetCountdownAlerts() {
        // Reset all countdown alerts for new mission
        for (const key of Object.keys(this.countdownAlerts)) {
          this.countdownAlerts[key].fired = false;
        }
      }
    };

    function toggleNotificationPanel() {
      document.getElementById('notificationPanel').classList.toggle('open');
    }

    function openNotificationSettings() {
      document.getElementById('notificationSettingsModal').classList.add('open');
    }

    function closeNotificationSettings() {
      NotificationSystem.saveSettings();
      document.getElementById('notificationSettingsModal').classList.remove('open');
    }

    document.addEventListener('click', (e) => {
      const panel = document.getElementById('notificationPanel');
      const bell = document.getElementById('notificationBell');
      if (!panel.contains(e.target) && !bell.contains(e.target)) {
        panel.classList.remove('open');
      }
    });

    // ===== MISSION MANAGER =====
    const MissionManager = {
      missions: [],
      currentMissionId: null,
      
      async init() {
        // Load saved mission preference
        this.currentMissionId = localStorage.getItem('artemisops_current_mission') || 'artemis-ii';
        
        // Fetch available missions
        await this.loadMissions();
        
        // Load the current mission
        await this.switchMission(this.currentMissionId, false);
      },
      
      async loadMissions() {
        try {
          const response = await fetch(`${CONFIG.API_BASE}/api/missions`);
          if (!response.ok) throw new Error('Failed to fetch missions');
          
          const data = await response.json();
          this.missions = data.missions || [];
          this.renderMissionSelector();
        } catch (error) {
          console.error('Failed to load missions:', error);
          // Add default option if API fails
          this.missions = [{ id: 'artemis-ii', name: 'Artemis II' }];
          this.renderMissionSelector();
        }
      },
      
      renderMissionSelector() {
        const selector = document.getElementById('missionSelector');
        if (!selector) return;
        
        selector.innerHTML = this.missions.map(m => 
          `<option value="${m.id}" ${m.id === this.currentMissionId ? 'selected' : ''}>${m.name}</option>`
        ).join('');
      },
      
      async switchMission(missionId, showLoading = true) {
        if (!missionId) return;
        
        console.log(`Switching to mission: ${missionId}`);
        this.currentMissionId = missionId;
        localStorage.setItem('artemisops_current_mission', missionId);
        
        // Show loading overlay
        if (showLoading) {
          document.getElementById('missionLoading').classList.add('active');
        }
        
        try {
          // Fetch full mission data
          const response = await fetch(`${CONFIG.API_BASE}/api/missions/${missionId}`);
          if (!response.ok) throw new Error('Failed to fetch mission');
          
          const data = await response.json();
          
          // Update header
          this.updateHeader(data);
          
          // Apply mission data
          applyMissionData(data);
          
          // Render crew
          if (data.crew && data.crew.length > 0) {
            renderCrew(data.crew);
          } else {
            document.getElementById('crewGrid').innerHTML = '<div class="crew-loading">No crew assigned to this mission</div>';
          }
          
          // Reset countdown alerts for new mission
          NotificationSystem.resetCountdownAlerts();
          
          // Fetch weather data for this mission
          await WeatherManager.checkAndFetch(missionId);
          
          // Subscribe to this mission via WebSocket
          if (ConnectionManager.ws && ConnectionManager.ws.readyState === WebSocket.OPEN) {
            ConnectionManager.ws.send(`subscribe:${missionId}`);
          }
          
        } catch (error) {
          console.error('Failed to switch mission:', error);
          showBanner(`Failed to load mission: ${error.message}`, 'error');
        } finally {
          // Hide loading overlay
          document.getElementById('missionLoading').classList.remove('active');
        }
      },
      
      updateHeader(data) {
        // Update title
        const titleEl = document.getElementById('missionTitle');
        if (titleEl) {
          titleEl.textContent = data.name || 'MISSION';
        }
        
        // Update subtitle based on mission
        const subtitleEl = document.getElementById('missionSubtitle');
        if (subtitleEl) {
          if (data.description) {
            // Truncate if too long
            const shortDesc = data.description.length > 60 
              ? data.description.substring(0, 57) + '...'
              : data.description;
            subtitleEl.textContent = shortDesc;
          } else {
            subtitleEl.textContent = data.name || '';
          }
        }
        
        // Update agency logo
        const agencyLogo = document.getElementById('agencyLogo');
        const agencyContainer = document.getElementById('agencyLogoContainer');
        if (agencyLogo && agencyContainer) {
          if (data.agency_logo) {
            agencyLogo.src = data.agency_logo;
            agencyLogo.alt = (data.agencies ? data.agencies[0] : 'Agency') + ' Logo';
            agencyLogo.style.display = 'block';
            agencyLogo.onerror = function() { this.style.display = 'none'; };
          } else {
            // Default to NASA logo
            agencyLogo.src = 'https://www.nasa.gov/wp-content/uploads/2023/04/nasa-logo-web-rgb.png';
            agencyLogo.alt = 'NASA Logo';
            agencyLogo.style.display = 'block';
          }
        }
        
        // Update mission patch
        const missionPatch = document.getElementById('missionPatch');
        const patchContainer = document.getElementById('missionPatchContainer');
        if (missionPatch && patchContainer) {
          if (data.mission_patch) {
            missionPatch.src = data.mission_patch;
            missionPatch.alt = (data.name || 'Mission') + ' Patch';
            missionPatch.style.display = 'block';
            missionPatch.onerror = function() { this.style.display = 'none'; };
          } else if (data.image) {
            // Fallback to general mission image
            missionPatch.src = data.image;
            missionPatch.alt = (data.name || 'Mission') + ' Image';
            missionPatch.style.display = 'block';
            missionPatch.onerror = function() { this.style.display = 'none'; };
          } else {
            // Hide if no image available
            missionPatch.style.display = 'none';
          }
        }
        
        // Update page title
        document.title = `ArtemisOps - ${data.name || 'Mission Control'}`;
      }
    };

    // ===== MAIN APPLICATION =====
    const CONFIG = {
      // API endpoints - use relative paths when served by backend
      API_BASE: window.location.origin,
      WS_URL: `${window.location.protocol === 'https:' ? 'wss:' : 'ws:'}//${window.location.host}/ws`,
      UPDATE_INTERVAL: 5 * 60 * 1000,
      RECONNECT_INTERVAL: 5000,
      FALLBACK_DATA: {
        name: 'Artemis II',
        launch_date: '2026-04-01T12:00:00Z',
        site: 'Kennedy Space Center, FL',
        status: 'Artemis II is in final preparations. The SLS rocket and Orion spacecraft are undergoing final integrated systems testing.',
        source: 'fallback',
        agencies: 'NASA, CSA',
        agency_logo: 'https://www.nasa.gov/wp-content/uploads/2023/04/nasa-logo-web-rgb.png',
        mission_patch: 'https://www.nasa.gov/wp-content/uploads/2025/04/jsc2025e034746orig.jpg',
        milestones: [
          { date: 'Dec 2025', title: 'Flight Readiness Review', description: 'Final comprehensive review of all mission systems', status: 'completed' },
          { date: 'Jan 2, 2026', title: 'Crew Quarantine Begins', description: 'Flight crew enters health stabilization program', status: 'completed' },
          { date: 'Jan 17, 2026', title: 'Final Vehicle Checks', description: 'Completing final integrated systems testing', status: 'active' },
          { date: 'Jan 24, 2026', title: 'Rollout to Pad 39B', description: 'SLS transported from VAB to launch complex', status: 'pending' },
          { date: 'Jan 27, 2026', title: 'Wet Dress Rehearsal', description: 'Full countdown simulation with propellant loading', status: 'pending' },
          { date: 'T-6:40:00', title: 'Cryo Loading', description: 'Begin loading liquid hydrogen and oxygen', status: 'pending' },
          { date: 'T-2:35:00', title: 'Crew Ingress', description: 'Four astronauts board Orion spacecraft', status: 'pending' },
          { date: 'T-00:00', title: 'LIFTOFF', description: 'RS-25 engines and SRBs ignite', status: 'pending' }
        ]
      }
    };

    // ===== CONNECTION MANAGER =====
    const ConnectionManager = {
      ws: null,
      isOnline: navigator.onLine,
      connectionState: 'connecting', // 'live', 'cached', 'offline'
      reconnectTimer: null,

      init() {
        // Listen for online/offline events
        window.addEventListener('online', () => this.handleOnline());
        window.addEventListener('offline', () => this.handleOffline());
        
        this.connectWebSocket();
      },

      connectWebSocket() {
        if (this.ws && this.ws.readyState === WebSocket.OPEN) return;
        
        try {
          this.ws = new WebSocket(CONFIG.WS_URL);
          
          this.ws.onopen = () => {
            console.log('WebSocket connected');
            this.setConnectionState('live');
            if (this.reconnectTimer) {
              clearInterval(this.reconnectTimer);
              this.reconnectTimer = null;
            }
          };
          
          this.ws.onmessage = (event) => {
            const message = JSON.parse(event.data);
            if (message.type === 'mission_update') {
              console.log('Received mission update via WebSocket');
              // Only apply if it's for the current mission
              if (message.data.id === MissionManager.currentMissionId) {
                applyMissionData(message.data);
                if (message.data.crew) {
                  renderCrew(message.data.crew);
                }
              }
            } else if (message.type === 'missions_list') {
              console.log('Received missions list via WebSocket');
              MissionManager.missions = message.data || [];
              MissionManager.renderMissionSelector();
            }
          };
          
          this.ws.onclose = () => {
            console.log('WebSocket disconnected');
            this.setConnectionState(this.isOnline ? 'cached' : 'offline');
            this.scheduleReconnect();
          };
          
          this.ws.onerror = (error) => {
            console.error('WebSocket error:', error);
          };
        } catch (e) {
          console.error('Failed to create WebSocket:', e);
          this.setConnectionState('cached');
        }
      },

      scheduleReconnect() {
        if (this.reconnectTimer) return;
        this.reconnectTimer = setInterval(() => {
          if (this.isOnline && (!this.ws || this.ws.readyState === WebSocket.CLOSED)) {
            console.log('Attempting to reconnect WebSocket...');
            this.connectWebSocket();
          }
        }, CONFIG.RECONNECT_INTERVAL);
      },

      handleOnline() {
        console.log('Network online');
        this.isOnline = true;
        this.connectWebSocket();
        loadMissionData(); // Refresh data
      },

      handleOffline() {
        console.log('Network offline');
        this.isOnline = false;
        this.setConnectionState('offline');
      },

      setConnectionState(state) {
        this.connectionState = state;
        updateConnectionIndicator(state);
      }
    };

    const appState = {
      launchDate: null,
      launchSite: '',
      missionStatus: '',
      milestones: [],
      dataSource: '',
      lastSuccessfulUpdate: null,
      previousMilestones: []
    };

    function showBanner(message, type = 'error') {
      const container = document.getElementById('errorContainer');
      container.innerHTML = `<div class="${type}-banner">${message}</div>`;
      setTimeout(() => container.innerHTML = '', 10000);
    }

    // Cache management
    const CacheManager = {
      CACHE_KEY: 'artemisops_mission_cache',
      
      save(data) {
        try {
          const cacheData = {
            data: data,
            timestamp: new Date().toISOString()
          };
          localStorage.setItem(this.CACHE_KEY, JSON.stringify(cacheData));
        } catch (e) {
          console.warn('Failed to cache data:', e);
        }
      },
      
      load() {
        try {
          const cached = localStorage.getItem(this.CACHE_KEY);
          if (cached) {
            const { data, timestamp } = JSON.parse(cached);
            data.source = 'cached';
            data.cached_at = timestamp;
            return data;
          }
        } catch (e) {
          console.warn('Failed to load cache:', e);
        }
        return null;
      },
      
      getAge() {
        try {
          const cached = localStorage.getItem(this.CACHE_KEY);
          if (cached) {
            const { timestamp } = JSON.parse(cached);
            return Date.now() - new Date(timestamp).getTime();
          }
        } catch (e) {}
        return Infinity;
      }
    };

    // Apply mission data to app state
    function applyMissionData(data) {
      const oldStatus = appState.missionStatus;
      
      appState.launchDate = data.launch_date ? new Date(data.launch_date) : null;
      appState.launchSite = data.site || CONFIG.FALLBACK_DATA.site;
      appState.missionStatus = data.status || CONFIG.FALLBACK_DATA.status;
      appState.dataSource = data.source || 'unknown';
      appState.lastSuccessfulUpdate = new Date();
      appState.milestones = data.milestones || CONFIG.FALLBACK_DATA.milestones;
      
      // Cache live data
      if (data.source === 'live') {
        CacheManager.save(data);
      }
      
      // Check for status changes
      if (oldStatus && oldStatus !== appState.missionStatus) {
        NotificationSystem.notifyStatusChange(oldStatus, appState.missionStatus);
      }
      
      checkMilestoneChanges();
      updateUI();
    }

    // Update connection indicator
    function updateConnectionIndicator(state) {
      const indicators = document.querySelectorAll('.live-indicator');
      indicators.forEach(indicator => {
        indicator.classList.remove('error', 'warning');
        if (state === 'offline') {
          indicator.classList.add('error');
        } else if (state === 'cached') {
          indicator.classList.add('warning');
        }
      });
      updateDataSourceLabels(state);
    }

    async function loadMissionData() {
      try {
        const response = await fetch(`${CONFIG.API_BASE}/api/mission`);
        if (!response.ok) throw new Error('API request failed');
        
        const data = await response.json();
        applyMissionData(data);
        ConnectionManager.setConnectionState(data.source === 'live' ? 'live' : 'cached');
        
      } catch (error) {
        console.error('Failed to load from API:', error);
        
        // Try to use cached data
        const cached = CacheManager.load();
        if (cached) {
          console.log('Using cached data');
          applyMissionData(cached);
          ConnectionManager.setConnectionState('cached');
        } else {
          // Use fallback
          console.log('Using fallback data');
          applyMissionData(CONFIG.FALLBACK_DATA);
          ConnectionManager.setConnectionState('offline');
        }
      }
    }

    function checkMilestoneChanges() {
      if (appState.previousMilestones.length === 0) {
        appState.previousMilestones = [...appState.milestones];
        return;
      }

      appState.milestones.forEach((milestone, index) => {
        const prev = appState.previousMilestones[index];
        if (prev && prev.status !== 'completed' && milestone.status === 'completed') {
          NotificationSystem.notifyMilestoneComplete(milestone);
        }
      });

      appState.previousMilestones = [...appState.milestones];
    }

    function updateDataSourceLabels(state) {
      let message = '';
      switch (state) {
        case 'live':
          message = '● Live';
          break;
        case 'cached':
          const age = CacheManager.getAge();
          const mins = Math.floor(age / 60000);
          message = mins > 0 ? `○ Cached (${mins}m ago)` : '○ Cached';
          break;
        case 'offline':
          message = '○ Offline';
          break;
        default:
          message = '...';
      }
      
      document.getElementById('launchDataSource').textContent = message;
      document.getElementById('timelineDataSource').textContent = message;
      document.getElementById('statusDataSource').textContent = message;
    }

    function updateCountdown() {
      const countdownDisplay = document.getElementById('countdownDisplay');
      const modeIndicator = document.getElementById('countdownModeIndicator');
      const daysEl = document.getElementById('days');
      const hoursEl = document.getElementById('hours');
      const minutesEl = document.getElementById('minutes');
      const secondsEl = document.getElementById('seconds');
      const launchInfoEl = document.getElementById('launchInfo');

      if (!appState.launchDate) {
        daysEl.textContent = '---';
        hoursEl.textContent = '--';
        minutesEl.textContent = '--';
        secondsEl.textContent = '--';
        modeIndicator.textContent = 'STANDBY';
        modeIndicator.className = 'countdown-mode-indicator countdown';
        countdownDisplay.classList.remove('elapsed-mode');
        return;
      }

      const now = new Date();
      const diff = appState.launchDate - now;
      const isPostLaunch = diff <= 0;

      // Calculate time values (absolute difference)
      const absDiff = Math.abs(diff);
      const days = Math.floor(absDiff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((absDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((absDiff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((absDiff % (1000 * 60)) / 1000);

      // Update display values
      daysEl.textContent = String(days).padStart(3, '0');
      hoursEl.textContent = String(hours).padStart(2, '0');
      minutesEl.textContent = String(minutes).padStart(2, '0');
      secondsEl.textContent = String(seconds).padStart(2, '0');

      if (isPostLaunch) {
        // ELAPSED TIME MODE (T+)
        countdownDisplay.classList.add('elapsed-mode');
        modeIndicator.textContent = 'T-PLUS · MISSION ELAPSED TIME';
        modeIndicator.className = 'countdown-mode-indicator elapsed';
        
        // Format launch date for display
        const launchDateStr = appState.launchDate.toLocaleDateString('en-US', {
          month: 'long', day: 'numeric', year: 'numeric',
          hour: '2-digit', minute: '2-digit'
        });
        launchInfoEl.textContent = `Launched: ${launchDateStr} | ${appState.launchSite}`;
      } else {
        // COUNTDOWN MODE (T-)
        countdownDisplay.classList.remove('elapsed-mode');
        modeIndicator.textContent = 'T-MINUS · COUNTDOWN TO LAUNCH';
        modeIndicator.className = 'countdown-mode-indicator countdown';
        
        // Check countdown alerts (only for pre-launch)
        const secondsRemaining = Math.floor(diff / 1000);
        NotificationSystem.checkCountdownAlerts(secondsRemaining);
        
        // Format target launch date for display
        const launchDateStr = appState.launchDate.toLocaleDateString('en-US', {
          month: 'long', day: 'numeric', year: 'numeric'
        });
        launchInfoEl.textContent = `Target Launch: ${launchDateStr} | ${appState.launchSite}`;
      }
    }

    function filterVisibleMilestones(milestones) {
      const now = new Date();
      const sixHoursAgo = new Date(now.getTime() - (6 * 60 * 60 * 1000));
      
      return milestones.filter(milestone => {
        if (milestone.status === 'active' || milestone.status === 'pending') return true;
        if (milestone.status === 'completed') {
          if (milestone.completedAt) {
            return new Date(milestone.completedAt) > sixHoursAgo;
          }
          return false;
        }
        return true;
      });
    }

    function renderTimeline() {
      const timelineEl = document.getElementById('timeline');
      
      if (!appState.milestones || appState.milestones.length === 0) {
        timelineEl.innerHTML = '<div style="text-align: center; padding: 40px; color: #ff9999;">Timeline data unavailable</div>';
        return;
      }
      
      const visibleMilestones = filterVisibleMilestones(appState.milestones);
      
      if (visibleMilestones.length === 0) {
        timelineEl.innerHTML = '<div style="text-align: center; padding: 40px; color: #8ab4f8;">All pre-launch milestones completed.</div>';
        return;
      }
      
      const completedCount = appState.milestones.filter(m => m.status === 'completed').length;
      const activeCount = appState.milestones.filter(m => m.status === 'active').length;
      const progressPercent = ((completedCount + (activeCount * 0.5)) / appState.milestones.length) * 100;
      
      timelineEl.innerHTML = `
        <div class="timeline-container">
          <div class="timeline-track" style="--progress: ${progressPercent}%">
            <div class="timeline-milestones" id="milestonesContainer"></div>
          </div>
        </div>
      `;
      
      const milestonesContainer = document.getElementById('milestonesContainer');

      visibleMilestones.forEach((milestone) => {
        const milestoneEl = document.createElement('div');
        milestoneEl.className = `milestone ${milestone.status}`;
        
        let statusIcon = '○';
        if (milestone.status === 'completed') statusIcon = '✓';
        if (milestone.status === 'active') statusIcon = '◉';

        milestoneEl.innerHTML = `
          <div class="milestone-status">${statusIcon}</div>
          <div class="milestone-marker"></div>
          <div class="milestone-content">
            <div class="milestone-date">${milestone.date}</div>
            <div class="milestone-title">${milestone.title}</div>
            <div class="milestone-description">${milestone.description}</div>
          </div>
        `;
        
        milestonesContainer.appendChild(milestoneEl);
      });
    }

    function updateNextMilestone() {
      const nextMilestone = appState.milestones.find(m => m.status === 'active' || m.status === 'pending');
      
      if (nextMilestone) {
        document.getElementById('nextMilestone').textContent = 
          `${nextMilestone.title}: ${nextMilestone.description}`;
      } else {
        document.getElementById('nextMilestone').textContent = 'No upcoming milestones';
      }
    }

    function updateMissionStatus() {
      const statusEl = document.getElementById('statusText');
      if (appState.missionStatus) {
        statusEl.textContent = appState.missionStatus;
      } else {
        statusEl.innerHTML = '<em style="color: #ff9999;">Mission status unavailable</em>';
      }
    }

    function updateLastUpdateTime() {
      const now = new Date();
      document.getElementById('lastUpdate').textContent = now.toLocaleString('en-US', {
        month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit'
      });
    }

    function updateUI() {
      updateCountdown();
      renderTimeline();
      updateNextMilestone();
      updateMissionStatus();
      updateLastUpdateTime();
    }

    async function init() {
      console.log('Initializing ArtemisOps...');
      
      // Initialize systems
      NotificationSystem.init();
      ConnectionManager.init();
      WeatherManager.init();
      
      // Initialize mission manager (loads missions and current mission)
      await MissionManager.init();
      
      // Start countdown timer
      setInterval(updateCountdown, 1000);
      
      // Periodic data refresh (backup for WebSocket)
      setInterval(async () => {
        // Only poll if WebSocket is not connected
        if (!ConnectionManager.ws || ConnectionManager.ws.readyState !== WebSocket.OPEN) {
          console.log('Polling for mission updates...');
          await MissionManager.switchMission(MissionManager.currentMissionId, false);
        }
      }, CONFIG.UPDATE_INTERVAL);
      
      console.log('ArtemisOps initialized successfully');
    }

    // Load and render crew data
    async function loadCrewData() {
      const crewGrid = document.getElementById('crewGrid');
      
      try {
        const response = await fetch(`${CONFIG.API_BASE}/api/crew`);
        if (!response.ok) throw new Error('Failed to fetch crew data');
        
        const data = await response.json();
        renderCrew(data.crew);
      } catch (error) {
        console.error('Failed to load crew:', error);
        crewGrid.innerHTML = '<div class="crew-loading">Crew information unavailable</div>';
      }
    }

    function renderCrew(crew) {
      const crewGrid = document.getElementById('crewGrid');
      
      if (!crew || crew.length === 0) {
        crewGrid.innerHTML = '<div class="crew-loading">No crew information available</div>';
        return;
      }
      
      crewGrid.innerHTML = crew.map(member => `
        <div class="crew-card">
          <img 
            src="${member.photo}" 
            alt="${member.name}" 
            class="crew-photo"
            onerror="this.outerHTML='<div class=crew-photo-placeholder>👨‍🚀</div>'"
          >
          <div class="crew-info">
            <div class="crew-name">${member.name}</div>
            <div class="crew-role">${member.role}</div>
            <span class="crew-agency">${member.agency}</span>
            <div class="crew-bio">${member.bio}</div>
            ${member.nasa_bio ? `<a href="${member.nasa_bio}" target="_blank" rel="noopener" class="crew-twitter">View Full Bio →</a>` : ''}
          </div>
        </div>
      `).join('');
    }

    // ===== WEATHER MANAGER =====
    const WeatherManager = {
      isVisible: false,
      manualOverride: null, // null = auto, true = force show, false = force hide
      lastData: null,
      
      init() {
        // Load manual override preference
        const savedOverride = localStorage.getItem('artemisops_weather_override');
        if (savedOverride !== null) {
          this.manualOverride = savedOverride === 'true' ? true : savedOverride === 'false' ? false : null;
        }
      },
      
      async checkAndFetch(missionId) {
        console.log('Checking weather for mission:', missionId);
        
        try {
          const response = await fetch(`${CONFIG.API_BASE}/api/missions/${missionId}/weather/launch-day`);
          if (!response.ok) throw new Error('Failed to fetch weather');
          
          const data = await response.json();
          this.lastData = data;
          
          // Determine visibility based on manual override or auto
          if (this.manualOverride !== null) {
            this.setVisibility(this.manualOverride);
          } else {
            this.setVisibility(data.show_weather);
          }
          
          // Render weather if visible
          if (this.isVisible && data.weather) {
            this.render(data);
          } else if (this.isVisible && !data.weather) {
            // Manual override but no weather data available
            this.renderNoData(data);
          }
          
        } catch (error) {
          console.error('Weather fetch error:', error);
          this.setVisibility(this.manualOverride === true);
          if (this.isVisible) {
            this.renderError();
          }
        }
      },
      
      setVisibility(visible) {
        this.isVisible = visible;
        const section = document.getElementById('weatherSection');
        const showBtn = document.getElementById('weatherShowBtn');
        
        if (section) {
          if (visible) {
            section.classList.add('visible');
          } else {
            section.classList.remove('visible');
          }
        }
        
        // Show the floating button when weather panel is hidden but user has override set to show
        if (showBtn) {
          if (!visible && this.manualOverride !== false) {
            showBtn.classList.add('visible');
          } else {
            showBtn.classList.remove('visible');
          }
        }
        
        this.updateToggleButton();
      },
      
      toggle() {
        // Cycle through: auto -> force show -> force hide -> auto
        if (this.manualOverride === null) {
          this.manualOverride = true;
        } else if (this.manualOverride === true) {
          this.manualOverride = false;
        } else {
          this.manualOverride = null;
        }
        
        // Save preference
        localStorage.setItem('artemisops_weather_override', 
          this.manualOverride === null ? 'null' : String(this.manualOverride));
        
        // Re-evaluate visibility
        if (this.manualOverride !== null) {
          this.setVisibility(this.manualOverride);
          if (this.isVisible && this.lastData) {
            if (this.lastData.weather) {
              this.render(this.lastData);
            } else {
              this.renderNoData(this.lastData);
            }
          }
        } else if (this.lastData) {
          this.setVisibility(this.lastData.show_weather);
          if (this.isVisible && this.lastData.weather) {
            this.render(this.lastData);
          }
        }
        
        this.updateToggleButton();
      },
      
      updateToggleButton() {
        const btn = document.getElementById('weatherToggleBtn');
        const showBtn = document.getElementById('weatherShowBtn');
        if (!btn) return;
        
        let label, className, showBtnLabel;
        if (this.manualOverride === null) {
          label = '☁️ AUTO';
          className = 'weather-toggle-btn auto';
          showBtnLabel = '☁️ Show Weather';
        } else if (this.manualOverride === true) {
          label = '☁️ ALWAYS ON';
          className = 'weather-toggle-btn on';
          showBtnLabel = '☁️ Show Weather';
        } else {
          label = '☁️ ALWAYS OFF';
          className = 'weather-toggle-btn off';
          showBtnLabel = '☁️ Weather Off';
        }
        
        btn.textContent = label;
        btn.className = className;
        btn.title = this.manualOverride === null 
          ? 'Weather: Auto (shows on launch/recovery day) - Click to force ON'
          : this.manualOverride 
            ? 'Weather: Always show - Click to force OFF'
            : 'Weather: Always hide - Click for AUTO mode';
        
        if (showBtn) {
          showBtn.textContent = showBtnLabel;
        }
      },
      
      render(data) {
        const content = document.getElementById('weatherContent');
        const title = document.getElementById('weatherTitle');
        
        if (!content || !data.weather) return;
        
        const weather = data.weather.launch || data.weather.landing;
        if (!weather || !weather.analysis) {
          this.renderNoData(data);
          return;
        }
        
        const analysis = weather.analysis;
        const conditions = analysis.conditions || {};
        const eventType = data.event_type || 'launch';
        const site = weather.site || data.launch_site || 'Unknown Site';
        
        // Update title
        title.textContent = eventType === 'recovery' 
          ? 'Recovery Site Weather' 
          : 'Launch Site Weather';
        
        // Viability badge class
        const viabilityClass = analysis.status === 'go' ? 'go' 
          : analysis.status === 'marginal' ? 'marginal' 
          : 'no-go';
        
        const viabilityLabel = analysis.status === 'go' ? 'GO' 
          : analysis.status === 'marginal' ? 'MARGINAL' 
          : 'NO-GO';
        
        content.innerHTML = `
          <div class="weather-header">
            <div class="weather-event-type">
              <span class="weather-event-badge">${eventType === 'recovery' ? '🎯 Recovery' : '🚀 Launch'} Day</span>
              <span class="weather-site">${site}</span>
            </div>
          </div>
          
          <div class="weather-status-card">
            <div class="weather-icon">${conditions.icon || '❓'}</div>
            <div class="weather-main">
              <div class="weather-condition">${conditions.description || 'Unknown'}</div>
              <div class="weather-temp">
                ${conditions.temperature_high_f ? `High: ${Math.round(conditions.temperature_high_f)}°F` : ''}
                ${conditions.temperature_low_f ? ` / Low: ${Math.round(conditions.temperature_low_f)}°F` : ''}
              </div>
            </div>
            <div class="weather-viability">
              <div class="viability-badge ${viabilityClass}">${viabilityLabel}</div>
            </div>
          </div>
          
          <div class="weather-details">
            <div class="weather-detail-item">
              <div class="weather-detail-value">${conditions.wind_speed_mph ? Math.round(conditions.wind_speed_mph) + ' mph' : '--'}</div>
              <div class="weather-detail-label">Wind Speed</div>
            </div>
            <div class="weather-detail-item">
              <div class="weather-detail-value">${conditions.wind_gust_mph ? Math.round(conditions.wind_gust_mph) + ' mph' : '--'}</div>
              <div class="weather-detail-label">Wind Gusts</div>
            </div>
            <div class="weather-detail-item">
              <div class="weather-detail-value">${conditions.precipitation_mm !== undefined ? conditions.precipitation_mm.toFixed(1) + ' mm' : '--'}</div>
              <div class="weather-detail-label">Precipitation</div>
            </div>
            <div class="weather-detail-item">
              <div class="weather-detail-value">${data.hours_until_launch !== null ? (data.hours_until_launch > 0 ? 'T-' + Math.round(data.hours_until_launch) + 'h' : 'NOW') : '--'}</div>
              <div class="weather-detail-label">${eventType === 'recovery' ? 'Until Recovery' : 'Until Launch'}</div>
            </div>
          </div>
          
          ${analysis.issues && analysis.issues.length > 0 ? `
            <div class="weather-issues">
              <div class="weather-issues-title">Weather Concerns</div>
              ${analysis.issues.map(issue => `<div class="weather-issue">${issue}</div>`).join('')}
            </div>
          ` : ''}
        `;
      },
      
      renderNoData(data) {
        const content = document.getElementById('weatherContent');
        const title = document.getElementById('weatherTitle');
        
        title.textContent = 'Launch Site Weather';
        
        const reason = data && data.weather && data.weather.reason 
          ? data.weather.reason 
          : 'Weather data not available for this date';
        
        content.innerHTML = `
          <div class="weather-loading">
            <div style="font-size: 2em; margin-bottom: 10px;">📡</div>
            <div>${reason}</div>
            <div style="margin-top: 10px; font-size: 0.85em; color: #6a7f99;">
              Weather panel is shown via manual override.
            </div>
          </div>
        `;
      },
      
      renderError() {
        const content = document.getElementById('weatherContent');
        content.innerHTML = `
          <div class="weather-loading">
            <div style="font-size: 2em; margin-bottom: 10px;">⚠️</div>
            <div>Unable to fetch weather data</div>
          </div>
        `;
      }
    };

    init();
  </script>
  
  <!-- Leaflet JS for ISS Tracker -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  
  <!-- ISS Tracker Module -->
  <script src="js/iss-tracker.js"></script>
  
  <!-- Spacecraft Icons Module -->
  <script src="js/spacecraft-icons.js"></script>
  
  <!-- UI Icons Module -->
  <script src="js/ui-icons.js"></script>
  
  <!-- Tracking Manager -->
  <script>
    // ===== TRACKING MANAGER =====
    const TrackingManager = {
      currentMode: 'iss',
      issTracker: null,
      showFootprint: true,
      showTrack: true,
      initialized: false,
      
      init() {
        console.log('Initializing TrackingManager...');
        // Initialize tracking icons
        this.initIcons();
      },
      
      initIcons() {
        // Set mode button icons
        document.querySelectorAll('.tracking-mode-btn').forEach(btn => {
          const mode = btn.dataset.mode;
          const iconSpan = btn.querySelector('.mode-icon');
          if (iconSpan && typeof SpacecraftIcons !== 'undefined') {
            if (mode === 'iss') {
              iconSpan.innerHTML = SpacecraftIcons.getIcon('iss', 20, 'currentColor');
            } else if (mode === 'artemis-ii') {
              iconSpan.innerHTML = SpacecraftIcons.getIcon('orion-esm', 20, 'currentColor');
            } else if (mode === 'artemis-iii') {
              iconSpan.innerHTML = SpacecraftIcons.getIcon('starship-hls', 20, 'currentColor');
            }
          }
        });
      },
      
      async initISSTracker() {
        if (this.issTracker) {
          console.log('ISS Tracker already initialized');
          return;
        }
        
        console.log('Initializing ISS Tracker...');
        
        // Wait for panel to be visible and have dimensions
        await new Promise(resolve => setTimeout(resolve, 100));
        
        const container = document.getElementById('iss-map');
        if (!container) {
          console.error('ISS map container not found');
          return;
        }
        
        // Create ISS tracker using our ISSTracker class
        this.issTracker = new ISSTracker('iss-map', {
          updateInterval: 5000,
          showGroundTrack: true,
          showFootprint: true,
          centerOnISS: false
        });
        
        // Override the onPositionUpdate to update our UI
        this.issTracker.onPositionUpdate = (data) => {
          this.updateISSUI(data);
        };
        
        await this.issTracker.init();
        
        // Load ISS crew
        this.loadISSCrew();
        
        console.log('ISS Tracker initialized successfully');
      },
      
      updateISSUI(data) {
        // Update data overlay
        const latEl = document.getElementById('issLat');
        const lngEl = document.getElementById('issLng');
        const altEl = document.getElementById('issAlt');
        const velEl = document.getElementById('issVel');
        
        if (latEl) {
          const lat = data.latitude;
          latEl.textContent = Math.abs(lat).toFixed(2) + '\u00b0' + (lat >= 0 ? 'N' : 'S');
        }
        if (lngEl) {
          const lng = data.longitude;
          lngEl.textContent = Math.abs(lng).toFixed(2) + '\u00b0' + (lng >= 0 ? 'E' : 'W');
        }
        if (altEl) {
          altEl.textContent = Math.round(data.altitude) + ' km';
        }
        if (velEl) {
          velEl.textContent = Math.round(data.velocity) + ' km/h';
        }
        
        // Update telemetry panel
        const altTelEl = document.getElementById('issAltTel');
        const visTelEl = document.getElementById('issVisTel');
        
        if (altTelEl) {
          altTelEl.textContent = Math.round(data.altitude) + ' km';
        }
        if (visTelEl && data.visibility) {
          visTelEl.textContent = data.visibility.charAt(0).toUpperCase() + data.visibility.slice(1);
        }
        
        // Update location
        this.updateISSLocation(data.latitude, data.longitude);
      },
      
      async updateISSLocation(lat, lng) {
        try {
          const response = await fetch(`https://api.wheretheiss.at/v1/coordinates/${lat},${lng}`);
          const data = await response.json();
          
          const locationEl = document.getElementById('issLocation');
          const countryEl = document.getElementById('issCountry');
          
          if (data.timezone_id) {
            const parts = data.timezone_id.split('/');
            const location = parts[parts.length - 1].replace(/_/g, ' ');
            if (locationEl) locationEl.textContent = location;
            if (countryEl) countryEl.textContent = data.country_code || 'Ocean';
          } else {
            if (locationEl) locationEl.textContent = 'Ocean';
            if (countryEl) countryEl.textContent = 'International Waters';
          }
        } catch (error) {
          const locationEl = document.getElementById('issLocation');
          if (locationEl) locationEl.textContent = lat.toFixed(1) + '\u00b0, ' + lng.toFixed(1) + '\u00b0';
        }
      },
      
      async loadISSCrew() {
        try {
          const response = await fetch('http://api.open-notify.org/astros.json');
          const data = await response.json();
          
          const issCrew = data.people.filter(p => p.craft === 'ISS');
          
          const crewCountEl = document.getElementById('issCrewCount');
          const crewListEl = document.getElementById('issCrewList');
          
          if (crewCountEl) crewCountEl.textContent = issCrew.length;
          
          if (crewListEl) {
            const crewHtml = issCrew.map(person => {
              // Determine agency from name (simplified heuristic)
              let agency = 'NASA';
              const name = person.name.toLowerCase();
              if (name.includes('kononenko') || name.includes('chub') || name.includes('prokopyev') || name.includes('petelin')) agency = 'RSA';
              if (name.includes('mogensen') || name.includes('cristoforetti')) agency = 'ESA';
              if (name.includes('furukawa') || name.includes('wakata') || name.includes('hoshide')) agency = 'JAXA';
              if (name.includes('hadfield') || name.includes('saint-jacques') || name.includes('hansen')) agency = 'CSA';
              
              return `
                <div class="crew-member">
                  <span class="crew-dot"></span>
                  ${person.name}
                  <span class="crew-agency">${agency}</span>
                </div>
              `;
            }).join('');
            
            crewListEl.innerHTML = crewHtml || '<div style="color: #8b949e; font-size: 0.7rem;">No crew data</div>';
          }
          
        } catch (error) {
          console.error('Failed to load ISS crew:', error);
          const crewListEl = document.getElementById('issCrewList');
          if (crewListEl) {
            crewListEl.innerHTML = '<div style="color: #8b949e; font-size: 0.7rem;">Crew data unavailable</div>';
          }
        }
      },
      
      switchMode(mode) {
        if (mode === this.currentMode) return;
        
        this.currentMode = mode;
        
        // Update mode buttons
        document.querySelectorAll('.tracking-mode-btn').forEach(btn => {
          btn.classList.toggle('active', btn.dataset.mode === mode);
        });
        
        // Show/hide containers
        const issContainer = document.getElementById('issTrackerContainer');
        const artemisIIContainer = document.getElementById('artemisIIContainer');
        const artemisIIIContainer = document.getElementById('artemisIIIContainer');
        const statusText = document.getElementById('trackingStatusText');
        const indicator = document.getElementById('trackingIndicator');
        
        // Hide all
        if (issContainer) issContainer.style.display = 'none';
        if (artemisIIContainer) artemisIIContainer.style.display = 'none';
        if (artemisIIIContainer) artemisIIIContainer.style.display = 'none';
        
        // Show selected
        switch (mode) {
          case 'iss':
            if (issContainer) issContainer.style.display = 'flex';
            if (statusText) statusText.textContent = 'ISS Live Tracking';
            if (indicator) indicator.className = 'live-indicator';
            // Initialize ISS tracker if not already
            if (!this.issTracker) {
              this.initISSTracker();
            } else {
              // Invalidate map size since container was hidden
              setTimeout(() => {
                if (this.issTracker && this.issTracker.map) {
                  this.issTracker.map.invalidateSize();
                }
              }, 100);
            }
            break;
            
          case 'artemis-ii':
            if (artemisIIContainer) artemisIIContainer.style.display = 'flex';
            if (statusText) statusText.textContent = 'Artemis II - Lunar Free Return';
            if (indicator) indicator.className = 'live-indicator warning';
            break;
            
          case 'artemis-iii':
            if (artemisIIIContainer) artemisIIIContainer.style.display = 'flex';
            if (statusText) statusText.textContent = 'Artemis III - NRHO + Landing';
            if (indicator) indicator.className = 'live-indicator warning';
            break;
        }
      },
      
      toggleFootprint() {
        this.showFootprint = !this.showFootprint;
        const btn = document.getElementById('btnFootprint');
        if (btn) btn.classList.toggle('active', this.showFootprint);
        if (this.issTracker) {
          this.issTracker.toggleFootprint(this.showFootprint);
        }
      },
      
      toggleTrack() {
        this.showTrack = !this.showTrack;
        const btn = document.getElementById('btnTrack');
        if (btn) btn.classList.toggle('active', this.showTrack);
        if (this.issTracker) {
          this.issTracker.toggleGroundTrack(this.showTrack);
        }
      },
      
      centerOnISS() {
        if (this.issTracker) {
          this.issTracker.centerOnISS();
        }
      },
      
      // Called when switching to tracking panel
      onPanelActivate() {
        if (this.currentMode === 'iss') {
          if (!this.issTracker) {
            this.initISSTracker();
          } else {
            // Invalidate map size
            setTimeout(() => {
              if (this.issTracker && this.issTracker.map) {
                this.issTracker.map.invalidateSize();
              }
            }, 100);
          }
        }
      }
    };
    
    // Initialize tracking when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
      TrackingManager.init();
    });
    
    // Extend ViewManager to handle tracking panel
    const originalSwitchPanel = ViewManager.switchPanel;
    ViewManager.switchPanel = function(panelId) {
      originalSwitchPanel.call(this, panelId);
      if (panelId === 'tracking') {
        TrackingManager.onPanelActivate();
      }
    };
  </script>
  
  <!-- Apply SVG icons on load -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Color palette
      const iconColor = '#4a9eff';
      const warningColor = '#ffa500';
      
      // Tab navigation icons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        const panel = btn.dataset.panel;
        const iconSpan = btn.querySelector('.tab-icon');
        if (iconSpan && panel) {
          iconSpan.innerHTML = UIIcons.get(panel, 18, iconColor);
          iconSpan.style.display = 'inline-flex';
          iconSpan.style.alignItems = 'center';
          iconSpan.style.verticalAlign = 'middle';
        }
      });
      
      // Mobile icon bar
      document.querySelectorAll('.icon-bar-btn').forEach(btn => {
        const panel = btn.dataset.panel;
        const iconSpan = btn.querySelector('.icon');
        if (iconSpan && panel) {
          iconSpan.innerHTML = UIIcons.get(panel, 24, 'currentColor');
          iconSpan.style.display = 'flex';
          iconSpan.style.alignItems = 'center';
          iconSpan.style.justifyContent = 'center';
        }
      });
      
      // Replace notification bell SVG with our custom icon
      const bellEl = document.querySelector('#notificationBell');
      if (bellEl) {
        const existingSvg = bellEl.querySelector('svg');
        if (existingSvg) {
          const wrapper = document.createElement('span');
          wrapper.innerHTML = UIIcons.get('notification', 24, iconColor);
          existingSvg.replaceWith(wrapper.firstChild);
        }
      }
      
      // Settings button icon
      const settingsBtn = document.querySelector('.notification-settings-btn');
      if (settingsBtn) {
        settingsBtn.innerHTML = `<span style="display:inline-flex;align-items:center;gap:4px;">${UIIcons.get('settings', 14, iconColor)} Settings</span>`;
      }
      
      // Sound preview button
      const soundBtn = document.querySelector('.sound-preview-btn');
      if (soundBtn) {
        soundBtn.innerHTML = UIIcons.get('sound', 18, iconColor);
      }
      
      // Events panel title icon
      const eventsPanelTitle = document.querySelector('.events-panel .panel-title');
      if (eventsPanelTitle) {
        eventsPanelTitle.innerHTML = `<span style="display:inline-flex;align-items:center;gap:8px;">${UIIcons.get('live', 18, warningColor)} Upcoming Live Events</span>`;
      }
      
      // Event item icons
      document.querySelectorAll('.event-icon').forEach(el => {
        el.innerHTML = UIIcons.get('video', 24, warningColor);
        el.style.display = 'flex';
        el.style.alignItems = 'center';
      });
    });
    
    // Override NotificationSystem methods to use SVG icons
    (function() {
      const originalShowToast = NotificationSystem.showToast;
      NotificationSystem.showToast = function(notification) {
        const container = document.getElementById('toastContainer');
        const toast = document.createElement('div');
        toast.className = `toast ${notification.type}`;
        
        // Map notification types to icon names and colors
        const iconMap = {
          'milestone': { name: 'checkCircle', color: '#4a9eff' },
          'countdown': { name: 'countdown', color: '#ffa500' },
          'status': { name: 'clipboard', color: '#4a9eff' },
          'alert': { name: 'alert', color: '#ff4444' },
          'success': { name: 'success', color: '#4aff9e' }
        };
        const iconInfo = iconMap[notification.type] || { name: 'notification', color: '#4a9eff' };
        
        toast.innerHTML = `
          <span class="toast-icon" style="display:flex;align-items:center;">${UIIcons.get(iconInfo.name, 28, iconInfo.color)}</span>
          <div class="toast-content">
            <div class="toast-title">${notification.title}</div>
            <div class="toast-body">${notification.body}</div>
          </div>
          <button class="toast-close" onclick="this.parentElement.remove()">${UIIcons.get('close', 16, '#6a7f99')}</button>
        `;
        container.appendChild(toast);
        setTimeout(() => { if (toast.parentElement) toast.remove(); }, 5000);
      };
      
      // Override renderNotifications to use SVG icons
      const originalRenderNotifications = NotificationSystem.renderNotifications;
      NotificationSystem.renderNotifications = function() {
        const list = document.getElementById('notificationList');
        const badge = document.getElementById('notificationBadge');
        const unreadCount = this.notifications.filter(n => !n.read).length;

        if (unreadCount > 0) {
          badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
          badge.classList.remove('hidden');
        } else {
          badge.classList.add('hidden');
        }

        if (this.notifications.length === 0) {
          list.innerHTML = '<div class="notification-empty">No notifications yet</div>';
          return;
        }

        const iconMap = {
          'milestone': { name: 'checkCircle', color: '#4a9eff' },
          'countdown': { name: 'countdown', color: '#ffa500' },
          'status': { name: 'clipboard', color: '#4a9eff' },
          'alert': { name: 'alert', color: '#ff4444' },
          'success': { name: 'success', color: '#4aff9e' }
        };

        list.innerHTML = this.notifications.map(n => {
          const iconInfo = iconMap[n.type] || { name: 'notification', color: '#4a9eff' };
          return `
            <div class="notification-item ${n.read ? '' : 'unread'} ${n.type}" 
                 onclick="NotificationSystem.markAsRead(${n.id})">
              <div class="notification-time">${this.formatTime(n.timestamp)}</div>
              <div class="notification-title" style="display:flex;align-items:center;gap:6px;">
                ${UIIcons.get(iconInfo.name, 16, iconInfo.color)}
                ${n.title}
              </div>
              <div class="notification-body">${n.body}</div>
            </div>
          `;
        }).join('');
      };
    })();
    
    // Override renderTimeline to use SVG milestone icons
    (function() {
      const originalRenderTimeline = window.renderTimeline;
      window.renderTimeline = function() {
        const timelineEl = document.getElementById('timeline');
        
        if (!appState.milestones || appState.milestones.length === 0) {
          timelineEl.innerHTML = '<div style="text-align: center; padding: 40px; color: #ff9999;">Timeline data unavailable</div>';
          return;
        }
        
        const visibleMilestones = filterVisibleMilestones(appState.milestones);
        
        if (visibleMilestones.length === 0) {
          timelineEl.innerHTML = '<div style="text-align: center; padding: 40px; color: #8ab4f8;">All pre-launch milestones completed.</div>';
          return;
        }
        
        const completedCount = appState.milestones.filter(m => m.status === 'completed').length;
        const activeCount = appState.milestones.filter(m => m.status === 'active').length;
        const progressPercent = ((completedCount + (activeCount * 0.5)) / appState.milestones.length) * 100;
        
        timelineEl.innerHTML = `
          <div class="timeline-container">
            <div class="timeline-track" style="--progress: ${progressPercent}%">
              <div class="timeline-milestones" id="milestonesContainer"></div>
            </div>
          </div>
        `;
        
        const milestonesContainer = document.getElementById('milestonesContainer');

        visibleMilestones.forEach((milestone) => {
          const milestoneEl = document.createElement('div');
          milestoneEl.className = `milestone ${milestone.status}`;
          
          // Use SVG icons for milestone status
          let statusIcon;
          if (milestone.status === 'completed') {
            statusIcon = UIIcons.get('milestoneComplete', 24, '#4a9eff');
          } else if (milestone.status === 'active') {
            statusIcon = UIIcons.get('milestoneActive', 24, '#ffa500');
          } else {
            statusIcon = UIIcons.get('milestonePending', 24, '#666');
          }

          milestoneEl.innerHTML = `
            <div class="milestone-status" style="display:flex;justify-content:center;">${statusIcon}</div>
            <div class="milestone-marker"></div>
            <div class="milestone-content">
              <div class="milestone-date">${milestone.date}</div>
              <div class="milestone-title">${milestone.title}</div>
              <div class="milestone-description">${milestone.description}</div>
            </div>
          `;
          
          milestonesContainer.appendChild(milestoneEl);
        });
      };
    })();
  </script>
</body>
</html>
